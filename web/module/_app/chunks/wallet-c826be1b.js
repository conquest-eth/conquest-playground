import{F as D,$ as A,H as M,a0 as O,G as S,a1 as W,a2 as j,a3 as F}from"./vendor-e78c39f1.js";import{c as v}from"./contracts-69d01f63.js";import{b as T,c as R,f as o,e as m,w as n,l as $,h as q,n as _,i as E,j as G}from"./config-af7f3a10.js";import{b as c}from"./paths-28a87002.js";const H=()=>{const t={},e=[],i={current:void 0};let u;const{subscribe:I,set:L}=D(i);function g(s){i.current=s,L(i),s&&s.delay&&(s.onAcknowledge&&s.onAcknowledge(),u=setTimeout(h,s.delay*1e3))}function h(){const s=i.current;s&&!s.delay&&s.onAcknowledge&&s.onAcknowledge();const N=e.shift();clearTimeout(u),g(N)}function x(s){if(s.id){if(t[s.id])return;t[s.id]=!0}e.length>0||i.current?e.push(s):g(s)}return{subscribe:I,queue:x,acknowledge:h,clear:()=>{e.splice(0,e.length),h()}}},b=H();typeof window!="undefined"&&(window.notifications=b);const y=typeof performance!="undefined";let l=Math.floor(y?(Date.now()-performance.now())/1e3:Date.now()/1e3);function d(){return y?Math.floor(performance.now()/1e3)+l:Math.floor(Date.now()/1e3)+l}let P=!1;function p(t){const e=d(),i=t-e;Math.abs(i)>T&&(l+=i),P=!0}function k(){return P}const z=A(d(),function(e){const i=setInterval(()=>{e(d())},1e3);return function(){clearInterval(i)}});typeof window!="undefined"&&(window.time={now:d,startTime:l,correctTime:p,isCorrected:k,time:z});const a=M("chainTempo");function J(t,e){for(let i=t.length-1;i>=0;i--)if(t[i]===e){t.splice(i,1);return}a.log("NOT FOUND")}class K{constructor(e){this.maxTimeout=e,this.blockListeners=[],this.currentProvider=void 0,this.lastUpdate=0,this.chainInfo={lastBlockNumber:void 0,stale:!0}}subscribe(e){return e(this.chainInfo),this.blockListeners.push(e),J.bind(null,this.blockListeners,e)}check(){const e=Date.now()/1e3;e-this.lastUpdate>this.maxTimeout-1&&(a.info(`timed out... ${e}  - ${this.lastUpdate} = ${e-this.lastUpdate} > ${this.maxTimeout-1}`),this.onBlock(void 0)),this.timeout=setTimeout(this.check.bind(this),this.maxTimeout*1e3)}async sync(){if(this.currentProvider){const e=await this.currentProvider.getBlockNumber();e>this.chainInfo.lastBlockNumber&&this.onBlock(e)}}startOrUpdateProvider(e){this.currentProvider!==e&&(this.currentProvider&&(a.info("stop listening for block event"),this.currentProvider.off("block",this.callback)),this.callback=this.onBlock.bind(this),this.currentProvider=e,this.currentProvider&&(a.info("listening for block event"),this.currentProvider.on("block",this.callback))),this.timeout||(this.timeout=setTimeout(this.check.bind(this),this.maxTimeout*1e3))}onBlock(e){e?(this.chainInfo.lastBlockNumber=e,this.chainInfo.stale=!1):this.chainInfo.stale=!0,this.lastUpdate=Date.now()/1e3,this.triggerListeners()}triggerListeners(){this.triggerTimeout&&clearTimeout(this.triggerTimeout),this.triggerTimeout=setTimeout(this.callListeners.bind(this),0)}callListeners(){a.info(`onBlock ${this.chainInfo.lastBlockNumber}`);for(const e of this.blockListeners)e(this.chainInfo)}}const U=new K(T*6),B=O({chainConfigs:S(v),builtin:{autoProbe:!0},transactions:{autoDelete:!0,finality:R},flow:{autoUnlock:!0},autoSelectPrevious:!0,localStoragePrefix:c&&c.startsWith("/ipfs/")||c.startsWith("/ipns/")?c.slice(6):void 0,options:["builtin",new W({nodeUrl:typeof o=="string"?o:void 0,chainId:m,infuraId:"bc0bdd4eaac640278cdebc3aa91fabe4"}),new j("7bc13179-0c86-4e5f-b8d4-ef91cd3e0882",{chainId:m,nodeUrl:typeof n=="string"&&n!==""?n:typeof o=="string"&&o!==""?o:void 0})],fallbackNode:o,checkGenesis:$}),{wallet:r,transactions:f,builtin:ie,chain:w,balance:se,flow:oe,fallback:Q}=B;function V(t){b.queue({id:t.hash,delay:0,title:"Transaction Error",text:"The Transaction failed",type:"error",onAcknowledge:()=>f.acknowledge(t.hash,"failure")})}function X(t){b.queue({id:t.hash,delay:3,title:"Transaction Cancelled",text:"The Transaction Has Been Replaced",type:"info",onAcknowledge:()=>f.acknowledge(t.hash,"cancelled")})}f.subscribe(t=>{for(const e of t.concat())e.confirmations>0&&!e.acknowledged&&(e.status==="failure"?V(e):e.status==="cancelled"?X(e):f.acknowledge(e.hash,e.status))});w.subscribe(async t=>{var e;if(U.startOrUpdateProvider(r.provider),!k()&&(t.state==="Connected"||t.state==="Ready")){const i=await((e=r.provider)==null?void 0:e.getBlock("latest"));i&&p(i.timestamp)}});Q.subscribe(async t=>{var e;if(!k()&&(t.state==="Connected"||t.state==="Ready")){const i=await((e=r.provider)==null?void 0:e.getBlock("latest"));i&&p(i.timestamp)}});let C;r.subscribe(async t=>{C!==t.address&&(C=t.address,F({address:t.address}))});typeof window!="undefined"&&(window.walletStores=B);U.startOrUpdateProvider(r.provider);v.subscribe(async t=>{await w.updateContracts(t)});async function ne(){let t;const e=[];n&&e.push(n),o&&n!==o&&e.push(o),await w.switchChain(m,{chainName:q,rpcUrls:e,blockExplorerUrls:t,nativeCurrency:{name:_,symbol:E,decimals:G}})}export{d as a,ie as b,w as c,Q as d,p as e,oe as f,U as g,k as i,b as n,ne as s,z as t,r as w};
//# sourceMappingURL=wallet-c826be1b.js.map
