var At=Object.defineProperty,Pt=Object.defineProperties;var Rt=Object.getOwnPropertyDescriptors;var Ne=Object.getOwnPropertySymbols;var Dt=Object.prototype.hasOwnProperty,It=Object.prototype.propertyIsEnumerable;var Le=(i,e,t)=>e in i?At(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,be=(i,e)=>{for(var t in e||(e={}))Dt.call(e,t)&&Le(i,t,e[t]);if(Ne)for(var t of Ne(e))It.call(e,t)&&Le(i,t,e[t]);return i},ge=(i,e)=>Pt(i,Rt(e));import{S as We,i as Ce,s as Oe,d as P,O as re,P as ce,v as Ge,t as y,l as $,k as w,g as f,e as C,n as M,z as J,c as O,f as Y,q as U,A as Q,j as G,L as S,B as K,m as se,r as ie,u as I,w as le,x as D,E as X,N as q,o as Ye,a5 as Fe,ar as fe,aY as ve,h as Z,as as Me,ag as Ue,ak as Ve,al as Tt,am as jt,p as de,at as qe,M as Nt}from"../chunks/vendor-e78c39f1.js";import{P as te}from"../chunks/PanelButton-b24a8fdb.js";import{N as He}from"../chunks/NavButton-b22b61c0.js";import{W as ze}from"../chunks/WalletAccess-ec429ef9.js";import{t as ke,w as x,a as Je,b as we}from"../chunks/wallet-c826be1b.js";import{H as Qe}from"../chunks/Help-b968899e.js";import{a as ne}from"../chunks/account-c0a26acd.js";import{a as oe,f as ye}from"../chunks/fleets-86e67def.js";import{s as ae}from"../chunks/spaceInfo-b394211b.js";import{t as me,p as ue}from"../chunks/privateWallet-7a0cfca0.js";import{C as $e}from"../chunks/Coord-ca78105f.js";import{b as Ke}from"../chunks/paths-28a87002.js";import{A as Xe,i as pe}from"../chunks/config-af7f3a10.js";import{b as Ee}from"../chunks/base-652be6d9.js";import"../chunks/Modal-a8884379.js";import"../chunks/contracts-69d01f63.js";import"../chunks/optimisticSpace-8b3fc51e.js";import"../chunks/subgraph-aa394bde.js";import"../chunks/graphql-582eebcc.js";import"../chunks/url-09d70f02.js";import"../chunks/Copiable-f9ca3aee.js";const Lt="src/lib/components/fleets/PendingFleetElement.svelte";function Ze(i){let e,t=me(ae.resolveWindow+i[3])+"",o,n;const r={c:function(){e=y("("),o=y(t),n=y(" left to resolve)")},l:function(l){e=$(l,"("),o=$(l,t),n=$(l," left to resolve)")},m:function(l,s){w(l,e,s),w(l,o,s),w(l,n,s)},p:function(l,s){s&8&&t!==(t=me(ae.resolveWindow+l[3])+"")&&se(o,t)},d:function(l){l&&f(e),l&&f(o),l&&f(n)}};return P("SvelteRegisterBlock",{block:r,id:Ze.name,type:"else",source:"(34:2) {:else}",ctx:i}),r}function xe(i){let e,t=me(i[3])+"",o;const n={c:function(){e=y("in "),o=y(t)},l:function(c){e=$(c,"in "),o=$(c,t)},m:function(c,l){w(c,e,l),w(c,o,l)},p:function(c,l){l&8&&t!==(t=me(c[3])+"")&&se(o,t)},d:function(c){c&&f(e),c&&f(o)}};return P("SvelteRegisterBlock",{block:n,id:xe.name,type:"if",source:"(32:2) {#if timeLeft >= 0}",ctx:i}),n}function Se(i){let e;const t={c:function(){e=y("(tx to resolve on its way...)")},l:function(n){e=$(n,"(tx to resolve on its way...)")},m:function(n,r){w(n,e,r)},d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:Se.name,type:"if",source:"(37:2) {#if fleet.resolution}",ctx:i}),t}function et(i){const e={c:q,l:q,m:q,p:q,i:q,o:q,d:q};return P("SvelteRegisterBlock",{block:e,id:et.name,type:"if",source:"(43:94) ",ctx:i}),e}function tt(i){let e,t;e=new te({props:{label:"submit",$$slots:{default:[nt]},$$scope:{ctx:i}},$$inline:!0}),e.$on("click",i[6]);const o={c:function(){J(e.$$.fragment)},l:function(r){Q(e.$$.fragment,r)},m:function(r,c){K(e,r,c),t=!0},p:function(r,c){const l={};c&128&&(l.$$scope={dirty:c,ctx:r}),e.$set(l)},i:function(r){t||(D(e.$$.fragment,r),t=!0)},o:function(r){I(e.$$.fragment,r),t=!1},d:function(r){X(e,r)}};return P("SvelteRegisterBlock",{block:o,id:tt.name,type:"if",source:"(41:2) {#if actionAvailable && (fleet.state === 'TRAVELING' || fleet.state === 'SEND_BROADCASTED') && !fleet.sending.action.queueID}",ctx:i}),o}function nt(i){let e;const t={c:function(){e=y("submit")},l:function(n){e=$(n,"submit")},m:function(n,r){w(n,e,r)},d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:nt.name,type:"slot",source:'(42:4) <Button label=\\"submit\\" on:click={submit}>',ctx:i}),t}function Be(i){let e,t,o=i[0].quantity+"",n,r,c=i[4].stats.name+"",l,s,a,u,h=i[5].stats.name+"",m,d,b,A,T,k,g=i[0].state+"",j,R,p,_,W;a=new $e({props:{location:i[4].location.id},$$inline:!0}),b=new $e({props:{location:i[5].location.id},$$inline:!0});function E(V,L){return V[3]>=0?xe:Ze}let H=E(i),v=H(i),B=i[0].resolution&&Se(i);const ee=[tt,et],z=[];function Te(V,L){return V[1]&&(V[0].state==="TRAVELING"||V[0].state==="SEND_BROADCASTED")&&!V[0].sending.action.queueID?0:V[0].state==="SEND_BROADCASTED"&&V[2]-V[0].sending.action.timestamp>30?1:-1}~(p=Te(i))&&(_=z[p]=ee[p](i));const je={c:function(){e=C("p"),t=y("fleets of "),n=y(o),r=y(" spaceships sent from "),l=y(c),s=M(),J(a.$$.fragment),u=y(" to reach "),m=y(h),d=M(),J(b.$$.fragment),A=M(),v.c(),T=M(),B&&B.c(),k=y(`
  (`),j=y(g),R=y(`)
  `),_&&_.c(),this.h()},l:function(L){e=O(L,"P",{});var N=Y(e);t=$(N,"fleets of "),n=$(N,o),r=$(N," spaceships sent from "),l=$(N,c),s=U(N),Q(a.$$.fragment,N),u=$(N," to reach "),m=$(N,h),d=U(N),Q(b.$$.fragment,N),A=U(N),v.l(N),T=U(N),B&&B.l(N),k=$(N,`
  (`),j=$(N,g),R=$(N,`)
  `),_&&_.l(N),N.forEach(f),this.h()},h:function(){G(e,Lt,27,0,1508)},m:function(L,N){w(L,e,N),S(e,t),S(e,n),S(e,r),S(e,l),S(e,s),K(a,e,null),S(e,u),S(e,m),S(e,d),K(b,e,null),S(e,A),v.m(e,null),S(e,T),B&&B.m(e,null),S(e,k),S(e,j),S(e,R),~p&&z[p].m(e,null),W=!0},p:function(L,[N]){(!W||N&1)&&o!==(o=L[0].quantity+"")&&se(n,o),H===(H=E(L))&&v?v.p(L,N):(v.d(1),v=H(L),v&&(v.c(),v.m(e,T))),L[0].resolution?B||(B=Se(L),B.c(),B.m(e,k)):B&&(B.d(1),B=null),(!W||N&1)&&g!==(g=L[0].state+"")&&se(j,g);let he=p;p=Te(L),p===he?~p&&z[p].p(L,N):(_&&(ie(),I(z[he],1,1,()=>{z[he]=null}),le()),~p?(_=z[p],_?_.p(L,N):(_=z[p]=ee[p](L),_.c()),D(_,1),_.m(e,null)):_=null)},i:function(L){W||(D(a.$$.fragment,L),D(b.$$.fragment,L),D(_),W=!0)},o:function(L){I(a.$$.fragment,L),I(b.$$.fragment,L),I(_),W=!1},d:function(L){L&&f(e),X(a),X(b),v.d(),B&&B.d(),~p&&z[p].d()}};return P("SvelteRegisterBlock",{block:je,id:Be.name,type:"component",source:"",ctx:i}),je}function Wt(){}function Ct(i,e,t){let o,n;re(ke,"time"),ce(i,ke,d=>t(2,n=d));let{$$slots:r={},$$scope:c}=e;Ge("PendingFleetElement",r,[]);let{fleet:l}=e,{actionAvailable:s}=e,a=l.from,u=l.to;async function h(){const d=ae.distance(a,u),b=ae.timeToArrive(a,u),{toHash:A,fleetId:T,secretHash:k}=await ne.hashFleet(a.location,u.location,l.gift,l.specific,l.arrivalTimeWanted,l.sending.action.nonce,l.owner,l.fleetSender,l.operator),{queueID:g}=await oe.submitReveal(T,k,a.location,u.location,d,l.arrivalTimeWanted,l.gift,l.specific,l.potentialAlliances,l.launchTime,b,l.fleetSender,l.operator);ne.recordQueueID(l.sending.id,g)}const m=["fleet","actionAvailable"];return Object.keys(e).forEach(d=>{!~m.indexOf(d)&&d.slice(0,2)!=="$$"&&d!=="slot"&&console.warn(`<PendingFleetElement> was created with unknown prop '${d}'`)}),i.$$set=d=>{"fleet"in d&&t(0,l=d.fleet),"actionAvailable"in d&&t(1,s=d.actionAvailable)},i.$capture_state=()=>({account:ne,agentService:oe,Button:te,spaceInfo:ae,time:ke,timeToText:me,Coord:$e,fleet:l,actionAvailable:s,from:a,to:u,submit:h,forget:Wt,timeLeft:o,$time:n}),i.$inject_state=d=>{"fleet"in d&&t(0,l=d.fleet),"actionAvailable"in d&&t(1,s=d.actionAvailable),"from"in d&&t(4,a=d.from),"to"in d&&t(5,u=d.to),"timeLeft"in d&&t(3,o=d.timeLeft)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty&5&&t(3,o=ae.timeLeft(n,a,u,l.launchTime).timeLeft)},[l,s,n,o,a,u,h]}class ot extends We{constructor(e){super(e);Ce(this,e,Ct,Be,Oe,{fleet:0,actionAvailable:1}),P("SvelteRegisterComponent",{component:this,tagName:"PendingFleetElement",options:e,id:Be.name});const{ctx:t}=this.$$,o=e.props||{};t[0]===void 0&&!("fleet"in o)&&console.warn("<PendingFleetElement> was created without expected prop 'fleet'"),t[1]===void 0&&!("actionAvailable"in o)&&console.warn("<PendingFleetElement> was created without expected prop 'actionAvailable'")}get fleet(){throw new Error("<PendingFleetElement>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set fleet(e){throw new Error("<PendingFleetElement>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get actionAvailable(){throw new Error("<PendingFleetElement>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set actionAvailable(e){throw new Error("<PendingFleetElement>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}}class Ot extends Ee{constructor(){super({type:"REGISTER_AGENT_SERVICE",step:"IDLE"})}async register(e){this.setPartial({step:"LOADING"});try{const t={player:x.address,delegate:e,nonceMsTimestamp:Je()*999+Math.floor(Date.now())%1e3},o=`conquest-agent-service: register ${t.delegate.toLowerCase()} as delegate for ${t.player.toLowerCase()} (nonce: ${t.nonceMsTimestamp})`,n=await x.provider.getSigner().signMessage(o),c=await(await fetch(`${Xe}/register`,{method:"POST",body:JSON.stringify(ge(be({},t),{signature:n}))})).json();c.success?(ne.recordAgentServiceDefault(!0),oe.triggerUpdate()):(console.error(c.error),this.setPartial({error:c.error||"unknown error"}))}catch(t){console.error(t),this.setPartial({error:t})}}async cancel(){this._reset()}async acknownledgeSuccess(){this._reset()}async acknownledgeError(){this.setPartial({error:void 0})}_reset(){this.setPartial({step:"IDLE"})}}var it=new Ot;class Gt extends Ee{constructor(){super({type:"TOPUP_AGENT_SERVICE",step:"IDLE"})}async topup(e){var o;let t;try{this.setPartial({step:"TRANSACTION"}),t=await x.provider.getSigner().sendTransaction({to:(o=x.contracts)==null?void 0:o.PaymentGateway.address,value:e.toHexString()})}catch(n){if(console.error(n),n.message&&n.message.indexOf("User denied")>=0){this.setPartial({step:"IDLE",error:void 0});return}this.setPartial({error:n,step:"IDLE"});return}t&&(await t.wait(),oe.triggerUpdate(),this.setPartial({step:"MINED"}))}async cancel(){this._reset()}async acknownledgeSuccess(){this._reset()}async acknownledgeError(){this.setPartial({error:void 0})}_reset(){this.setPartial({step:"IDLE"})}}var lt=new Gt;class Yt extends Ee{constructor(){super({type:"WITHDRAW_AGENT_SERVICE",step:"IDLE"})}async withdraw(){var t;let e;try{const o={player:x.address,delegate:ue.signer.address.toLowerCase(),nonceMsTimestamp:Je()*999+Math.floor(Date.now())%1e3},n=`withdraw:${x.address}:${o.nonceMsTimestamp}`,r=await ue.signer.signMessage(n),l=await(await fetch(`${Xe}/requestWithdrawal`,{method:"POST",body:JSON.stringify(ge(be({},o),{signature:r}))})).json();l.signature?l.amount==="0"?(console.error("zero balance"),this.setPartial({error:{message:"zero balance"}})):(oe.triggerUpdate(),this.setPartial({step:"TRANSACTION"}),e=await((t=x.contracts)==null?void 0:t.PaymentWithdrawalGateway.withdraw(x.address,l.amount,l.timestamp,l.signature,l.amount))):(console.error(l.error),this.setPartial({error:l.error||"unknown error"}))}catch(o){if(console.error(o),o.message&&o.message.indexOf("User denied")>=0){this.setPartial({step:"IDLE",error:void 0});return}this.setPartial({error:o,step:"IDLE"});return}e&&(await e.wait(),oe.triggerUpdate(),this.setPartial({step:"MINED"}))}async cancel(){this._reset()}async acknownledgeSuccess(){this._reset()}async acknownledgeError(){this.setPartial({error:void 0})}_reset(){this.setPartial({step:"IDLE"})}}var rt=new Yt;const F="src/routes/agent-service.svelte";function _e(i,e,t){const o=i.slice();return o[18]=e[t],o}function ct(i){let e;const t={c:function(){e=y("Go To Game")},l:function(n){e=$(n,"Go To Game")},m:function(n,r){w(n,e,r)},d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:ct.name,type:"slot",source:'(32:2) <NavButton class=\\"absolute\\" label=\\"Back To Game\\" href={`${base}/`}>',ctx:i}),t}function st(i){let e;const t={c:function(){e=y(`The agent service is provided by Etherplay to help your fleets being resolved in time. In order to work, the
          service need to be paid for. Please top-up to ensure your fleet are resolved.`)},l:function(n){e=$(n,`The agent service is provided by Etherplay to help your fleets being resolved in time. In order to work, the
          service need to be paid for. Please top-up to ensure your fleet are resolved.`)},m:function(n,r){w(n,e,r)},d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:st.name,type:"slot",source:'(40:8) <Help class=\\"w-4 h-4\\">',ctx:i}),t}function Ae(i){let e,t,o,n,r,c,l,s,a;const u={c:function(){e=C("div"),t=C("p"),o=y(`The agent service is provided by Etherplay to help your fleets being resolved in time. In order to work, the
          service need to be paid for. Please top-up to ensure your fleet are resolved.`),n=M(),r=C("p"),c=y(`Note that we cannot guarantee that fleets will be resolved and this service is purely optional. You can always
          resolve your fleet manually. We will do our best to broadcast the transaction in time.`),l=M(),s=C("p"),a=y(`We will also do our best to keep your fleet destination private and we will never read the data, except for
          debugging purpose but with no intent to use that information in game.`),this.h()},l:function(m){e=O(m,"DIV",{class:!0});var d=Y(e);t=O(d,"P",{});var b=Y(t);o=$(b,`The agent service is provided by Etherplay to help your fleets being resolved in time. In order to work, the
          service need to be paid for. Please top-up to ensure your fleet are resolved.`),b.forEach(f),n=U(d),r=O(d,"P",{});var A=Y(r);c=$(A,`Note that we cannot guarantee that fleets will be resolved and this service is purely optional. You can always
          resolve your fleet manually. We will do our best to broadcast the transaction in time.`),A.forEach(f),l=U(d),s=O(d,"P",{});var T=Y(s);a=$(T,`We will also do our best to keep your fleet destination private and we will never read the data, except for
          debugging purpose but with no intent to use that information in game.`),T.forEach(f),d.forEach(f),this.h()},h:function(){G(t,F,47,8,2227),G(r,F,51,8,2459),G(s,F,55,8,2702),Z(e,"class","flex flex-col text-center justify-center text-red-500 mb-8"),G(e,F,46,6,2146)},m:function(m,d){w(m,e,d),S(e,t),S(t,o),S(e,n),S(e,r),S(r,c),S(e,l),S(e,s),S(s,a)},d:function(m){m&&f(e)}};return P("SvelteRegisterBlock",{block:u,id:Ae.name,type:"if",source:"(46:4) {#if $privateWallet.step === 'READY'}",ctx:i}),u}function at(i){var j;let e,t,o,n,r=(j=i[1].account)==null?void 0:j.balance.gt(0),c,l,s=[],a=new Map,u;const h=[pt,mt],m=[];function d(R,p){return R[0]?1:0}e=d(i),t=m[e]=h[e](i);let b=r&&Pe(i),A=i[9].fleets;Ue(A);const T=R=>R[18].txHash;Ve(i,A,_e,T);for(let R=0;R<A.length;R+=1){let p=_e(i,A,R),_=T(p);a.set(_,s[R]=De(_,p))}let k=null;A.length||(k=Re(i));const g={c:function(){t.c(),o=M(),n=C("p"),b&&b.c(),c=M(),l=C("ul");for(let p=0;p<s.length;p+=1)s[p].c();k&&k.c(),this.h()},l:function(p){t.l(p),o=U(p),n=O(p,"P",{class:!0});var _=Y(n);b&&b.l(_),_.forEach(f),c=U(p),l=O(p,"UL",{class:!0});var W=Y(l);for(let E=0;E<s.length;E+=1)s[E].l(W);k&&k.l(W),W.forEach(f),this.h()},h:function(){Z(n,"class","mb-4"),G(n,F,139,10,5918),Z(l,"class","list-disc text-yellow-600"),G(l,F,177,10,7512)},m:function(p,_){m[e].m(p,_),w(p,o,_),w(p,n,_),b&&b.m(n,null),w(p,c,_),w(p,l,_);for(let W=0;W<s.length;W+=1)s[W].m(l,null);k&&k.m(l,null),u=!0},p:function(p,_){var E;let W=e;e=d(p),e===W?m[e].p(p,_):(ie(),I(m[W],1,1,()=>{m[W]=null}),le(),t=m[e],t?t.p(p,_):(t=m[e]=h[e](p),t.c()),D(t,1),t.m(o.parentNode,o)),_&2&&(r=(E=p[1].account)==null?void 0:E.balance.gt(0)),r?b?(b.p(p,_),_&2&&D(b,1)):(b=Pe(p),b.c(),D(b,1),b.m(n,null)):b&&(ie(),I(b,1,1,()=>{b=null}),le()),_&529&&(A=p[9].fleets,Ue(A),ie(),Ve(p,A,_e,T),s=Tt(s,_,T,1,p,A,a,l,jt,De,null,_e),le(),A.length?k&&(k.d(1),k=null):k||(k=Re(p),k.c(),k.m(l,null)))},i:function(p){if(!u){D(t),D(b);for(let _=0;_<A.length;_+=1)D(s[_]);u=!0}},o:function(p){I(t),I(b);for(let _=0;_<s.length;_+=1)I(s[_]);u=!1},d:function(p){m[e].d(p),p&&f(o),p&&f(n),b&&b.d(),p&&f(c),p&&f(l);for(let _=0;_<s.length;_+=1)s[_].d();k&&k.d()}};return P("SvelteRegisterBlock",{block:g,id:at.name,type:"else",source:"(81:8) {:else}",ctx:i}),g}function ut(i){let e;const t={c:function(){e=y("Loading...")},l:function(n){e=$(n,"Loading...")},m:function(n,r){w(n,e,r)},p:q,i:q,o:q,d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:ut.name,type:"if",source:"(79:52) ",ctx:i}),t}function ft(i){let e,t,o,n;const r=[Et,$t],c=[];function l(a,u){return a[5].step==="CONNECTING"?0:1}e=l(i),t=c[e]=r[e](i);const s={c:function(){t.c(),o=de()},l:function(u){t.l(u),o=de()},m:function(u,h){c[e].m(u,h),w(u,o,h),n=!0},p:function(u,h){let m=e;e=l(u),e===m?c[e].p(u,h):(ie(),I(c[m],1,1,()=>{c[m]=null}),le(),t=c[e],t?t.p(u,h):(t=c[e]=r[e](u),t.c()),D(t,1),t.m(o.parentNode,o))},i:function(u){n||(D(t),n=!0)},o:function(u){I(t),n=!1},d:function(u){c[e].d(u),u&&f(o)}};return P("SvelteRegisterBlock",{block:s,id:ft.name,type:"if",source:"(64:8) {#if $privateWallet.step !== 'READY'}",ctx:i}),s}function mt(i){let e,t,o,n,r,c=fe(i[1].account.balance)+"",l,s,a,u,h,m,d,b,A,T,k,g,j,R;const p=[_t,dt],_=[];function W(H,v){return H[4]?0:1}e=W(i),t=_[e]=p[e](i),h=new te({props:{class:"w-max-content mt-4 mx-4",label:"Top Up",$$slots:{default:[kt]},$$scope:{ctx:i}},$$inline:!0}),h.$on("click",i[15]);const E={c:function(){t.c(),o=M(),n=C("p"),r=y(`Your Balance:
              `),l=y(c),s=y(`
              $`),a=y(pe),u=M(),J(h.$$.fragment),m=M(),d=C("p"),b=y("You can adjust the amount here"),A=M(),T=C("p"),k=C("input"),this.h()},l:function(v){t.l(v),o=U(v),n=O(v,"P",{});var B=Y(n);r=$(B,`Your Balance:
              `),l=$(B,c),s=$(B,`
              $`),a=$(B,pe),u=U(B),Q(h.$$.fragment,B),B.forEach(f),m=U(v),d=O(v,"P",{class:!0});var ee=Y(d);b=$(ee,"You can adjust the amount here"),ee.forEach(f),A=U(v),T=O(v,"P",{});var z=Y(T);k=O(z,"INPUT",{class:!0,step:!0,type:!0}),z.forEach(f),this.h()},h:function(){G(n,F,116,12,5107),Z(d,"class","text-xs"),G(d,F,133,12,5698),Z(k,"class","bg-gray-800 text-xs"),Z(k,"step","0.1"),Z(k,"type","number"),G(k,F,135,14,5782),G(T,F,134,12,5764)},m:function(v,B){_[e].m(v,B),w(v,o,B),w(v,n,B),S(n,r),S(n,l),S(n,s),S(n,a),S(n,u),K(h,n,null),w(v,m,B),w(v,d,B),S(d,b),w(v,A,B),w(v,T,B),S(T,k),qe(k,i[2]),g=!0,j||(R=Nt(k,"input",i[16]),j=!0)},p:function(v,B){let ee=e;e=W(v),e===ee?_[e].p(v,B):(ie(),I(_[ee],1,1,()=>{_[ee]=null}),le(),t=_[e],t?t.p(v,B):(t=_[e]=p[e](v),t.c()),D(t,1),t.m(o.parentNode,o)),(!g||B&2)&&c!==(c=fe(v[1].account.balance)+"")&&se(l,c);const z={};B&2097156&&(z.$$scope={dirty:B,ctx:v}),h.$set(z),B&4&&Me(k.value)!==v[2]&&qe(k,v[2])},i:function(v){g||(D(t),D(h.$$.fragment,v),g=!0)},o:function(v){I(t),I(h.$$.fragment,v),g=!1},d:function(v){_[e].d(v),v&&f(o),v&&f(n),X(h),v&&f(m),v&&f(d),v&&f(A),v&&f(T),j=!1,R()}};return P("SvelteRegisterBlock",{block:E,id:mt.name,type:"else",source:"(92:10) {:else}",ctx:i}),E}function pt(i){let e,t,o;t=new te({props:{class:"w-max-content m-4",label:"register",$$slots:{default:[wt]},$$scope:{ctx:i}},$$inline:!0}),t.$on("click",i[12]);const n={c:function(){e=y(`You need to register
            `),J(t.$$.fragment)},l:function(c){e=$(c,`You need to register
            `),Q(t.$$.fragment,c)},m:function(c,l){w(c,e,l),K(t,c,l),o=!0},p:function(c,l){const s={};l&2097152&&(s.$$scope={dirty:l,ctx:c}),t.$set(s)},i:function(c){o||(D(t.$$.fragment,c),o=!0)},o:function(c){I(t.$$.fragment,c),o=!1},d:function(c){c&&f(e),X(t,c)}};return P("SvelteRegisterBlock",{block:n,id:pt.name,type:"if",source:"(84:10) {#if !registered}",ctx:i}),n}function dt(i){let e,t,o=fe(i[3])+"",n,r,c,l,s,a;const u={c:function(){e=C("p"),t=y("You do not have enough balance. You need at least "),n=y(o),r=y(" $"),c=y(pe),l=M(),s=C("p"),a=y("please top-up"),this.h()},l:function(m){e=O(m,"P",{});var d=Y(e);t=$(d,"You do not have enough balance. You need at least "),n=$(d,o),r=$(d," $"),c=$(d,pe),d.forEach(f),l=U(m),s=O(m,"P",{});var b=Y(s);a=$(b,"please top-up"),b.forEach(f),this.h()},h:function(){G(e,F,109,14,4900),G(s,F,113,14,5055)},m:function(m,d){w(m,e,d),S(e,t),S(e,n),S(e,r),S(e,c),w(m,l,d),w(m,s,d),S(s,a)},p:function(m,d){d&8&&o!==(o=fe(m[3])+"")&&se(n,o)},i:q,o:q,d:function(m){m&&f(e),m&&f(l),m&&f(s)}};return P("SvelteRegisterBlock",{block:u,id:dt.name,type:"else",source:"(109:12) {:else}",ctx:i}),u}function _t(i){let e,t,o,n;const r=[bt,ht],c=[];function l(a,u){var h,m;return((m=(h=a[8].data)==null?void 0:h.agentServiceDefault)==null?void 0:m.activated)?1:0}e=l(i),t=c[e]=r[e](i);const s={c:function(){t.c(),o=de()},l:function(u){t.l(u),o=de()},m:function(u,h){c[e].m(u,h),w(u,o,h),n=!0},p:function(u,h){let m=e;e=l(u),e===m?c[e].p(u,h):(ie(),I(c[m],1,1,()=>{c[m]=null}),le(),t=c[e],t?t.p(u,h):(t=c[e]=r[e](u),t.c()),D(t,1),t.m(o.parentNode,o))},i:function(u){n||(D(t),n=!0)},o:function(u){I(t),n=!1},d:function(u){c[e].d(u),u&&f(o)}};return P("SvelteRegisterBlock",{block:s,id:_t.name,type:"if",source:"(93:12) {#if enoughBalance}",ctx:i}),s}function ht(i){let e,t,o,n,r;n=new te({props:{class:"w-max-content m-4",label:"activate",$$slots:{default:[gt]},$$scope:{ctx:i}},$$inline:!0}),n.$on("click",i[14]);const c={c:function(){e=C("p"),t=y("Agent service is active by default"),o=M(),J(n.$$.fragment),this.h()},l:function(s){e=O(s,"P",{});var a=Y(e);t=$(a,"Agent service is active by default"),a.forEach(f),o=U(s),Q(n.$$.fragment,s),this.h()},h:function(){G(e,F,101,16,4587)},m:function(s,a){w(s,e,a),S(e,t),w(s,o,a),K(n,s,a),r=!0},p:function(s,a){const u={};a&2097152&&(u.$$scope={dirty:a,ctx:s}),n.$set(u)},i:function(s){r||(D(n.$$.fragment,s),r=!0)},o:function(s){I(n.$$.fragment,s),r=!1},d:function(s){s&&f(e),s&&f(o),X(n,s)}};return P("SvelteRegisterBlock",{block:c,id:ht.name,type:"else",source:"(101:14) {:else}",ctx:i}),c}function bt(i){let e,t,o,n,r;n=new te({props:{class:"w-max-content m-4",label:"activate",$$slots:{default:[vt]},$$scope:{ctx:i}},$$inline:!0}),n.$on("click",i[13]);const c={c:function(){e=C("p"),t=y("Agent is not active by default, it will require manual submission"),o=M(),J(n.$$.fragment),this.h()},l:function(s){e=O(s,"P",{});var a=Y(e);t=$(a,"Agent is not active by default, it will require manual submission"),a.forEach(f),o=U(s),Q(n.$$.fragment,s),this.h()},h:function(){G(e,F,94,16,4262)},m:function(s,a){w(s,e,a),S(e,t),w(s,o,a),K(n,s,a),r=!0},p:function(s,a){const u={};a&2097152&&(u.$$scope={dirty:a,ctx:s}),n.$set(u)},i:function(s){r||(D(n.$$.fragment,s),r=!0)},o:function(s){I(n.$$.fragment,s),r=!1},d:function(s){s&&f(e),s&&f(o),X(n,s)}};return P("SvelteRegisterBlock",{block:c,id:bt.name,type:"if",source:"(94:14) {#if !$account.data?.agentServiceDefault?.activated}",ctx:i}),c}function gt(i){let e;const t={c:function(){e=y("Deactivate?")},l:function(n){e=$(n,"Deactivate?")},m:function(n,r){w(n,e,r)},d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:gt.name,type:"slot",source:'(103:16) <Button                   class=\\"w-max-content m-4\\"                   label=\\"activate\\"                   on:click={() => account.recordAgentServiceDefault(false)}>',ctx:i}),t}function vt(i){let e;const t={c:function(){e=y("Activate?")},l:function(n){e=$(n,"Activate?")},m:function(n,r){w(n,e,r)},d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:vt.name,type:"slot",source:'(96:16) <Button                   class=\\"w-max-content m-4\\"                   label=\\"activate\\"                   on:click={() => account.recordAgentServiceDefault(true)}>',ctx:i}),t}function kt(i){let e,t,o;const n={c:function(){e=y("Top Up ("),t=y(i[2]),o=y(")")},l:function(c){e=$(c,"Top Up ("),t=$(c,i[2]),o=$(c,")")},m:function(c,l){w(c,e,l),w(c,t,l),w(c,o,l)},p:function(c,l){l&4&&se(t,c[2])},d:function(c){c&&f(e),c&&f(t),c&&f(o)}};return P("SvelteRegisterBlock",{block:n,id:kt.name,type:"slot",source:`(125:14) <Button                 class=\\"w-max-content mt-4 mx-4\\"                 label=\\"Top Up\\"                 on:click={() => agentService_topup.topup(parseEther('' + topupValueInEth))}               >`,ctx:i}),n}function wt(i){let e;const t={c:function(){e=y("Register")},l:function(n){e=$(n,"Register")},m:function(n,r){w(n,e,r)},d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:wt.name,type:"slot",source:'(87:12) <Button               class=\\"w-max-content m-4\\"               label=\\"register\\"               on:click={() => agentService_register.register($privateWallet.signer.address)}>',ctx:i}),t}function Pe(i){let e,t;e=new te({props:{class:"w-max-content mt-4 mx-4",color:"text-red-300",cornerColor:"border-red-300",label:"Withdraw",$$slots:{default:[yt]},$$scope:{ctx:i}},$$inline:!0}),e.$on("click",i[17]);const o={c:function(){J(e.$$.fragment)},l:function(r){Q(e.$$.fragment,r)},m:function(r,c){K(e,r,c),t=!0},p:function(r,c){const l={};c&2097152&&(l.$$scope={dirty:c,ctx:r}),e.$set(l)},i:function(r){t||(D(e.$$.fragment,r),t=!0)},o:function(r){I(e.$$.fragment,r),t=!1},d:function(r){X(e,r)}};return P("SvelteRegisterBlock",{block:o,id:Pe.name,type:"if",source:"(141:12) {#if $agentService.account?.balance.gt(0)}",ctx:i}),o}function yt(i){let e;const t={c:function(){e=y("Withdraw All")},l:function(n){e=$(n,"Withdraw All")},m:function(n,r){w(n,e,r)},d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:yt.name,type:"slot",source:'(142:14) <Button                 class=\\"w-max-content mt-4 mx-4\\"                 color=\\"text-red-300\\"                 cornerColor=\\"border-red-300\\"                 label=\\"Withdraw\\"                 on:click={() => agentService_withdraw.withdraw()}               >',ctx:i}),t}function Re(i){let e;const t={c:function(){e=y("No Fleets")},l:function(n){e=$(n,"No Fleets")},m:function(n,r){w(n,e,r)},d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:Re.name,type:"else",source:"(181:12) {:else}",ctx:i}),t}function De(i,e){let t,o,n;o=new ot({props:{fleet:e[18],actionAvailable:e[0]&&e[4]},$$inline:!0});const r={key:i,first:null,c:function(){t=C("li"),J(o.$$.fragment),this.h()},l:function(l){t=O(l,"LI",{});var s=Y(t);Q(o.$$.fragment,s),s.forEach(f),this.h()},h:function(){G(t,F,179,14,7627),this.first=t},m:function(l,s){w(l,t,s),K(o,t,null),n=!0},p:function(l,s){e=l;const a={};s&512&&(a.fleet=e[18]),s&17&&(a.actionAvailable=e[0]&&e[4]),o.$set(a)},i:function(l){n||(D(o.$$.fragment,l),n=!0)},o:function(l){I(o.$$.fragment,l),n=!1},d:function(l){l&&f(t),X(o)}};return P("SvelteRegisterBlock",{block:r,id:De.name,type:"each",source:"(179:12) {#each $fleetList.fleets as fleet (fleet.txHash)}",ctx:e}),r}function $t(i){let e,t;e=new te({props:{class:"w-max-content m-4",label:"connect",disabled:!i[6].available||i[7].connecting,$$slots:{default:[St]},$$scope:{ctx:i}},$$inline:!0}),e.$on("click",i[11]);const o={c:function(){J(e.$$.fragment)},l:function(r){Q(e.$$.fragment,r)},m:function(r,c){K(e,r,c),t=!0},p:function(r,c){const l={};c&192&&(l.disabled=!r[6].available||r[7].connecting),c&2097152&&(l.$$scope={dirty:c,ctx:r}),e.$set(l)},i:function(r){t||(D(e.$$.fragment,r),t=!0)},o:function(r){I(e.$$.fragment,r),t=!1},d:function(r){X(e,r)}};return P("SvelteRegisterBlock",{block:o,id:$t.name,type:"else",source:"(67:10) {:else}",ctx:i}),o}function Et(i){let e,t;const o={c:function(){e=C("p"),t=y("Connecting..."),this.h()},l:function(r){e=O(r,"P",{});var c=Y(e);t=$(c,"Connecting..."),c.forEach(f),this.h()},h:function(){G(e,F,65,12,3167)},m:function(r,c){w(r,e,c),S(e,t)},p:q,i:q,o:q,d:function(r){r&&f(e)}};return P("SvelteRegisterBlock",{block:o,id:Et.name,type:"if",source:"(65:10) {#if $privateWallet.step === 'CONNECTING'}",ctx:i}),o}function St(i){let e;const t={c:function(){e=y("Connect")},l:function(n){e=$(n,"Connect")},m:function(n,r){w(n,e,r)},d:function(n){n&&f(e)}};return P("SvelteRegisterBlock",{block:t,id:St.name,type:"slot",source:'(68:12) <Button               class=\\"w-max-content m-4\\"               label=\\"connect\\"               disabled={!$builtin.available || $wallet.connecting}               on:click={() => privateWallet.login()}             >',ctx:i}),t}function Bt(i){let e,t,o,n,r,c,l,s,a,u,h;n=new Qe({props:{class:"w-4 h-4",$$slots:{default:[st]},$$scope:{ctx:i}},$$inline:!0});let m=i[5].step==="READY"&&Ae(i);const d=[ft,ut,at],b=[];function A(k,g){return k[5].step!=="READY"?0:k[1].state==="Loading"?1:2}a=A(i),u=b[a]=d[a](i);const T={c:function(){e=C("div"),t=C("h1"),o=y(`conquest.eth agent service
        `),J(n.$$.fragment),r=M(),m&&m.c(),c=M(),l=C("div"),s=C("div"),u.c(),this.h()},l:function(g){e=O(g,"DIV",{class:!0});var j=Y(e);t=O(j,"H1",{class:!0});var R=Y(t);o=$(R,`conquest.eth agent service
        `),Q(n.$$.fragment,R),R.forEach(f),j.forEach(f),r=U(g),m&&m.l(g),c=U(g),l=O(g,"DIV",{class:!0});var p=Y(l);s=O(p,"DIV",{class:!0});var _=Y(s);u.l(_),_.forEach(f),p.forEach(f),this.h()},h:function(){Z(t,"class","text-4xl m-4 mt-10"),G(t,F,37,6,1754),Z(e,"class","flex justify-center flex-wrap text-cyan-300"),G(e,F,36,4,1690),Z(s,"class","w-full justify-center text-center"),G(s,F,62,6,3008),Z(l,"class","flex justify-center flex-wrap text-cyan-300"),G(l,F,61,4,2944)},m:function(g,j){w(g,e,j),S(e,t),S(t,o),K(n,t,null),w(g,r,j),m&&m.m(g,j),w(g,c,j),w(g,l,j),S(l,s),b[a].m(s,null),h=!0},p:function(g,j){const R={};j&2097152&&(R.$$scope={dirty:j,ctx:g}),n.$set(R),g[5].step==="READY"?m||(m=Ae(g),m.c(),m.m(c.parentNode,c)):m&&(m.d(1),m=null);let p=a;a=A(g),a===p?b[a].p(g,j):(ie(),I(b[p],1,1,()=>{b[p]=null}),le(),u=b[a],u?u.p(g,j):(u=b[a]=d[a](g),u.c()),D(u,1),u.m(s,null))},i:function(g){h||(D(n.$$.fragment,g),D(u),h=!0)},o:function(g){I(n.$$.fragment,g),I(u),h=!1},d:function(g){g&&f(e),X(n),g&&f(r),m&&m.d(g),g&&f(c),g&&f(l),b[a].d()}};return P("SvelteRegisterBlock",{block:T,id:Bt.name,type:"slot",source:"(36:2) <WalletAccess>",ctx:i}),T}function Ie(i){let e,t,o,n,r;t=new He({props:{class:"absolute",label:"Back To Game",href:`${Ke}/`,$$slots:{default:[ct]},$$scope:{ctx:i}},$$inline:!0}),n=new ze({props:{$$slots:{default:[Bt]},$$scope:{ctx:i}},$$inline:!0});const c={c:function(){e=C("div"),J(t.$$.fragment),o=M(),J(n.$$.fragment),this.h()},l:function(s){e=O(s,"DIV",{class:!0});var a=Y(e);Q(t.$$.fragment,a),o=U(a),Q(n.$$.fragment,a),a.forEach(f),this.h()},h:function(){Z(e,"class","w-full h-full bg-black"),G(e,F,30,0,1506)},m:function(s,a){w(s,e,a),K(t,e,null),S(e,o),K(n,e,null),r=!0},p:function(s,[a]){const u={};a&2097152&&(u.$$scope={dirty:a,ctx:s}),t.$set(u);const h={};a&2098175&&(h.$$scope={dirty:a,ctx:s}),n.$set(h)},i:function(s){r||(D(t.$$.fragment,s),D(n.$$.fragment,s),r=!0)},o:function(s){I(t.$$.fragment,s),I(n.$$.fragment,s),r=!1},d:function(s){s&&f(e),X(t),X(n)}};return P("SvelteRegisterBlock",{block:c,id:Ie.name,type:"component",source:"",ctx:i}),c}function Ft(i,e,t){let o,n,r,c,l,s,a,u,h;re(oe,"agentService"),ce(i,oe,E=>t(1,c=E)),re(ue,"privateWallet"),ce(i,ue,E=>t(5,l=E)),re(we,"builtin"),ce(i,we,E=>t(6,s=E)),re(x,"wallet"),ce(i,x,E=>t(7,a=E)),re(ne,"account"),ce(i,ne,E=>t(8,u=E)),re(ye,"fleetList"),ce(i,ye,E=>t(9,h=E));let{$$slots:m={},$$scope:d}=e;Ge("Agent_service",m,[]);var b;let A;Ye(()=>{t(2,A=.9)});const T=[];Object.keys(e).forEach(E=>{!~T.indexOf(E)&&E.slice(0,2)!=="$$"&&E!=="slot"&&console.warn(`<Agent_service> was created with unknown prop '${E}'`)});const k=()=>ue.login(),g=()=>it.register(l.signer.address),j=()=>ne.recordAgentServiceDefault(!0),R=()=>ne.recordAgentServiceDefault(!1),p=()=>lt.topup(ve(""+A));function _(){A=Me(this.value),t(2,A)}const W=()=>rt.withdraw();return i.$capture_state=()=>({_a:b,Button:te,NavButton:He,WalletAccess:ze,wallet:x,builtin:we,Help:Qe,PendingFleetElement:ot,base:Ke,privateWallet:ue,agentService:oe,nativeTokenSymbol:pe,agentService_register:it,agentService_topup:lt,BigNumber:Fe,formatEther:fe,parseEther:ve,account:ne,fleetList:ye,onMount:Ye,agentService_withdraw:rt,topupValueInEth:A,minimumBalance:r,registered:o,enoughBalance:n,$agentService:c,$privateWallet:l,$builtin:s,$wallet:a,$account:u,$fleetList:h}),i.$inject_state=E=>{"_a"in E&&t(10,b=E._a),"topupValueInEth"in E&&t(2,A=E.topupValueInEth),"minimumBalance"in E&&t(3,r=E.minimumBalance),"registered"in E&&t(0,o=E.registered),"enoughBalance"in E&&t(4,n=E.enoughBalance)},e&&"$$inject"in e&&i.$inject_state(e.$$inject),i.$$.update=()=>{i.$$.dirty&2&&t(0,o=c.account&&c.account.delegate),i.$$.dirty&3&&t(4,n=o&&c.account.balance.gte(c.account.minimumBalance)),i.$$.dirty&1026&&t(3,r=c.account?Fe.from(t(10,b=c.account)===null||b===void 0?void 0:b.minimumBalance):ve("0.01"))},[o,c,A,r,n,l,s,a,u,h,b,k,g,j,R,p,_,W]}class fn extends We{constructor(e){super(e);Ce(this,e,Ft,Ie,Oe,{}),P("SvelteRegisterComponent",{component:this,tagName:"Agent_service",options:e,id:Ie.name})}}export{fn as default};
//# sourceMappingURL=agent-service.svelte-a410ac3f.js.map
