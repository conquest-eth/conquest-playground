import{S as Qe,i as ze,s as Ke,d as j,O as be,P as $e,v as Ue,o as ke,aJ as ce,a7 as ee,af as he,Q as Xe,z as q,A as G,B as H,x as E,u as M,E as Q,n as W,p as ge,q as T,k,w as te,g as m,e as C,c as L,f as I,h as K,j as P,r as ne,t as R,l as A,L as J,m as oe,M as se,at as ve,N as z}from"../../chunks/vendor-e78c39f1.js";import{P as U}from"../../chunks/PanelButton-b24a8fdb.js";import{u as we}from"../../chunks/config-af7f3a10.js";import{B as ae}from"../../chunks/Blockie-6a051512.js";import{W as ye}from"../../chunks/WalletAccess-ec429ef9.js";import{w as Y,f as Z}from"../../chunks/wallet-c826be1b.js";import{i as re}from"../../chunks/contracts-69d01f63.js";import{f as Be}from"../../chunks/privateWallet-7a0cfca0.js";import{m as ie,M as je}from"../../chunks/MessageFlow-30f15648.js";import"../../chunks/myplanets-2a339ebc.js";import"../../chunks/spaceInfo-b394211b.js";import"../../chunks/tokenClaim-d54d7ab7.js";import"../../chunks/planets-78a3d361.js";import"../../chunks/playersQuery-3a795d59.js";import"../../chunks/fleets-86e67def.js";import"../../chunks/optimisticSpace-8b3fc51e.js";import"../../chunks/token-c96bed7f.js";import"../../chunks/account-c0a26acd.js";import"../../chunks/myprofile-37a6a38f.js";import"../../chunks/logo-8502b062.js";import"../../chunks/plugins-94e9a3e2.js";import"../../chunks/Copiable-f9ca3aee.js";import"../../chunks/NavButton-b22b61c0.js";import"../../chunks/Modal-a8884379.js";import"../../chunks/paths-28a87002.js";import"../../chunks/base-652be6d9.js";import"../../chunks/subgraph-aa394bde.js";import"../../chunks/graphql-582eebcc.js";const{console:Ze}=Xe,N="src/routes/external/basic-alliances.svelte";function Re(l){let e,n,i,t,o,r,f,a,u,d,b,w,D;e=new U({props:{class:"float-right",label:"Disconnect",$$slots:{default:[Se]},$$scope:{ctx:l}},$$inline:!0}),e.$on("click",l[9]);let h=l[0]&&fe(l);const g=[Le,Ce,Me,De,Ee],B=[];function F(c,s){return s&80&&(t=null),c[5]==="LOADING"?0:c[5]==="IDLE"?1:c[0]?(t==null&&(t=c[6].address.toLowerCase()!==c[4]),t?3:4):2}o=F(l,-1),r=B[o]=g[o](l);function V(c,s){var $;return s&80&&(a=null),a==null&&(a=!!(c[4]&&(($=c[6].address)==null?void 0:$.toLowerCase())===c[4])),a?Ve:Oe}let v=V(l,-1),y=v(l);w=new U({props:{label:"Create",$$slots:{default:[We]},$$scope:{ctx:l}},$$inline:!0}),w.$on("click",l[10]);const _={c:function(){q(e.$$.fragment),n=W(),h&&h.c(),i=W(),r.c(),f=W(),y.c(),u=W(),d=C("div"),b=C("div"),q(w.$$.fragment),this.h()},l:function(s){G(e.$$.fragment,s),n=T(s),h&&h.l(s),i=T(s),r.l(s),f=T(s),y.l(s),u=T(s),d=L(s,"DIV",{});var $=I(d);b=L($,"DIV",{});var p=I(b);G(w.$$.fragment,p),p.forEach(m),$.forEach(m),this.h()},h:function(){P(b,N,204,8,7425),P(d,N,200,6,7295)},m:function(s,$){H(e,s,$),k(s,n,$),h&&h.m(s,$),k(s,i,$),B[o].m(s,$),k(s,f,$),y.m(s,$),k(s,u,$),k(s,d,$),J(d,b),H(w,b,null),D=!0},p:function(s,$){const p={};$&524288&&(p.$$scope={dirty:$,ctx:s}),e.$set(p),s[0]?h?(h.p(s,$),$&1&&E(h,1)):(h=fe(s),h.c(),E(h,1),h.m(i.parentNode,i)):h&&(ne(),M(h,1,1,()=>{h=null}),te());let S=o;o=F(s,$),o===S?B[o].p(s,$):(ne(),M(B[S],1,1,()=>{B[S]=null}),te(),r=B[o],r?r.p(s,$):(r=B[o]=g[o](s),r.c()),E(r,1),r.m(f.parentNode,f)),v!==(v=V(s,$))&&(y.d(1),y=v(s),y&&(y.c(),y.m(u.parentNode,u)));const O={};$&524288&&(O.$$scope={dirty:$,ctx:s}),w.$set(O)},i:function(s){D||(E(e.$$.fragment,s),E(h),E(r),E(w.$$.fragment,s),D=!0)},o:function(s){M(e.$$.fragment,s),M(h),M(r),M(w.$$.fragment,s),D=!1},d:function(s){Q(e,s),s&&m(n),h&&h.d(s),s&&m(i),B[o].d(s),s&&m(f),y.d(s),s&&m(u),s&&m(d),Q(w)}};return j("SvelteRegisterBlock",{block:_,id:Re.name,type:"else",source:"(143:4) {:else}",ctx:l}),_}function Ae(l){let e,n;e=new U({props:{label:"Connect",$$slots:{default:[Te]},$$scope:{ctx:l}},$$inline:!0}),e.$on("click",l[8]);const i={c:function(){q(e.$$.fragment)},l:function(o){G(e.$$.fragment,o)},m:function(o,r){H(e,o,r),n=!0},p:function(o,r){const f={};r&524288&&(f.$$scope={dirty:r,ctx:o}),e.$set(f)},i:function(o){n||(E(e.$$.fragment,o),n=!0)},o:function(o){M(e.$$.fragment,o),n=!1},d:function(o){Q(e,o)}};return j("SvelteRegisterBlock",{block:i,id:Ae.name,type:"if",source:"(141:4) {#if $wallet.state !== 'Ready'}",ctx:l}),i}function Se(l){let e;const n={c:function(){e=R("Disconnect")},l:function(t){e=A(t,"Disconnect")},m:function(t,o){k(t,e,o)},d:function(t){t&&m(e)}};return j("SvelteRegisterBlock",{block:n,id:Se.name,type:"slot",source:'(144:6) <PanelButton class=\\"float-right\\" on:click={disconnect} label=\\"Disconnect\\">',ctx:l}),n}function fe(l){let e,n,i,t,o;n=new ae({props:{address:l[0],class:"w-10 h-10 inline"},$$inline:!0});const r={c:function(){e=C("h1"),q(n.$$.fragment),i=R(" Alliance "),t=R(l[0]),this.h()},l:function(a){e=L(a,"H1",{class:!0});var u=I(e);G(n.$$.fragment,u),i=A(u," Alliance "),t=A(u,l[0]),u.forEach(m),this.h()},h:function(){K(e,"class","text-xl text-yellow-500 m-4"),P(e,N,146,8,5277)},m:function(a,u){k(a,e,u),H(n,e,null),J(e,i),J(e,t),o=!0},p:function(a,u){const d={};u&1&&(d.address=a[0]),n.$set(d),(!o||u&1)&&oe(t,a[0])},i:function(a){o||(E(n.$$.fragment,a),o=!0)},o:function(a){M(n.$$.fragment,a),o=!1},d:function(a){a&&m(e),Q(n)}};return j("SvelteRegisterBlock",{block:r,id:fe.name,type:"if",source:"(146:6) {#if id}",ctx:l}),r}function Ee(l){let e,n,i,t,o,r,f,a,u,d,b,w,D,h,g,B,F,V;w=new U({props:{label:"Add Member",$$slots:{default:[Ie]},$$scope:{ctx:l}},$$inline:!0}),w.$on("click",l[13]),g=new U({props:{label:"Join",$$slots:{default:[Pe]},$$scope:{ctx:l}},$$inline:!0}),g.$on("click",l[12]);const v={c:function(){e=C("h2"),n=R("You are the administrator of this alliance. do you want to add members?"),i=W(),t=C("p"),o=R("Please copy their signed message into the box to add the members"),r=W(),f=C("div"),a=C("div"),u=C("textarea"),d=W(),b=C("div"),q(w.$$.fragment),D=W(),h=C("div"),q(g.$$.fragment),this.h()},l:function(_){e=L(_,"H2",{class:!0});var c=I(e);n=A(c,"You are the administrator of this alliance. do you want to add members?"),c.forEach(m),i=T(_),t=L(_,"P",{});var s=I(t);o=A(s,"Please copy their signed message into the box to add the members"),s.forEach(m),r=T(_),f=L(_,"DIV",{});var $=I(f);a=L($,"DIV",{});var p=I(a);u=L(p,"TEXTAREA",{class:!0}),I(u).forEach(m),p.forEach(m),d=T($),b=L($,"DIV",{});var S=I(b);G(w.$$.fragment,S),S.forEach(m),$.forEach(m),D=T(_),h=L(_,"DIV",{});var O=I(h);G(g.$$.fragment,O),O.forEach(m),this.h()},h:function(){K(e,"class","text-xl text-green-500"),P(e,N,178,8,6470),P(t,N,179,8,6590),K(u,"class","bg-gray-800 w-80 h-80"),P(u,N,182,12,6704),P(a,N,181,10,6686),P(b,N,184,10,6799),P(f,N,180,8,6670),P(h,N,189,8,6936)},m:function(_,c){k(_,e,c),J(e,n),k(_,i,c),k(_,t,c),J(t,o),k(_,r,c),k(_,f,c),J(f,a),J(a,u),ve(u,l[1]),J(f,d),J(f,b),H(w,b,null),k(_,D,c),k(_,h,c),H(g,h,null),B=!0,F||(V=se(u,"input",l[16]),F=!0)},p:function(_,c){c&2&&ve(u,_[1]);const s={};c&524288&&(s.$$scope={dirty:c,ctx:_}),w.$set(s);const $={};c&524288&&($.$$scope={dirty:c,ctx:_}),g.$set($)},i:function(_){B||(E(w.$$.fragment,_),E(g.$$.fragment,_),B=!0)},o:function(_){M(w.$$.fragment,_),M(g.$$.fragment,_),B=!1},d:function(_){_&&m(e),_&&m(i),_&&m(t),_&&m(r),_&&m(f),Q(w),_&&m(D),_&&m(h),Q(g),F=!1,V()}};return j("SvelteRegisterBlock",{block:v,id:Ee.name,type:"else",source:"(178:6) {:else}",ctx:l}),v}function De(l){let e,n,i,t,o,r,f,a,u,d,b,w,D,h,g,B,F,V;o=new U({props:{label:"Join",$$slots:{default:[Ne]},$$scope:{ctx:l}},$$inline:!0}),o.$on("click",l[11]);let v=l[2]&&ue(l);a=new ae({props:{class:"w-6 h-6 m-1 inline",address:l[4]},$$inline:!0}),g=new U({props:{label:"Join",$$slots:{default:[Je]},$$scope:{ctx:l}},$$inline:!0}),g.$on("click",l[12]);const y={c:function(){e=C("h2"),n=R("Do you want to join the alliance ?"),i=W(),t=C("div"),q(o.$$.fragment),r=W(),v&&v.c(),f=R(`

        The Administrator to contact : `),q(a.$$.fragment),u=R(l[4]),d=R(" ("),b=C("button"),w=R("contact admin"),D=R(`)

        `),h=C("div"),q(g.$$.fragment),this.h()},l:function(c){e=L(c,"H2",{class:!0});var s=I(e);n=A(s,"Do you want to join the alliance ?"),s.forEach(m),i=T(c),t=L(c,"DIV",{});var $=I(t);G(o.$$.fragment,$),$.forEach(m),r=T(c),v&&v.l(c),f=A(c,`

        The Administrator to contact : `),G(a.$$.fragment,c),u=A(c,l[4]),d=A(c," ("),b=L(c,"BUTTON",{class:!0});var p=I(b);w=A(p,"contact admin"),p.forEach(m),D=A(c,`)

        `),h=L(c,"DIV",{});var S=I(h);G(g.$$.fragment,S),S.forEach(m),this.h()},h:function(){K(e,"class","text-xl text-green-500"),P(e,N,159,8,5738),P(t,N,160,8,5821),K(b,"class","underline"),P(b,N,169,102,6216),P(h,N,174,8,6345)},m:function(c,s){k(c,e,s),J(e,n),k(c,i,s),k(c,t,s),H(o,t,null),k(c,r,s),v&&v.m(c,s),k(c,f,s),H(a,c,s),k(c,u,s),k(c,d,s),k(c,b,s),J(b,w),k(c,D,s),k(c,h,s),H(g,h,null),B=!0,F||(V=se(b,"click",l[15],!1,!1,!1),F=!0)},p:function(c,s){const $={};s&524288&&($.$$scope={dirty:s,ctx:c}),o.$set($),c[2]?v?v.p(c,s):(v=ue(c),v.c(),v.m(f.parentNode,f)):v&&(v.d(1),v=null);const p={};s&16&&(p.address=c[4]),a.$set(p),(!B||s&16)&&oe(u,c[4]);const S={};s&524288&&(S.$$scope={dirty:s,ctx:c}),g.$set(S)},i:function(c){B||(E(o.$$.fragment,c),E(a.$$.fragment,c),E(g.$$.fragment,c),B=!0)},o:function(c){M(o.$$.fragment,c),M(a.$$.fragment,c),M(g.$$.fragment,c),B=!1},d:function(c){c&&m(e),c&&m(i),c&&m(t),Q(o),c&&m(r),v&&v.d(c),c&&m(f),Q(a,c),c&&m(u),c&&m(d),c&&m(b),c&&m(D),c&&m(h),Q(g),F=!1,V()}};return j("SvelteRegisterBlock",{block:y,id:De.name,type:"if",source:"(159:56) ",ctx:l}),y}function Me(l){const e={c:z,l:z,m:z,p:z,i:z,o:z,d:z};return j("SvelteRegisterBlock",{block:e,id:Me.name,type:"if",source:"(157:20) ",ctx:l}),e}function Ce(l){let e,n,i,t=l[3]&&me(l);n=new U({props:{label:"load",$$slots:{default:[Fe]},$$scope:{ctx:l}},$$inline:!0}),n.$on("click",l[14]);const o={c:function(){t&&t.c(),e=W(),q(n.$$.fragment)},l:function(f){t&&t.l(f),e=T(f),G(n.$$.fragment,f)},m:function(f,a){t&&t.m(f,a),k(f,e,a),H(n,f,a),i=!0},p:function(f,a){f[3]?t?t.p(f,a):(t=me(f),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null);const u={};a&524288&&(u.$$scope={dirty:a,ctx:f}),n.$set(u)},i:function(f){i||(E(n.$$.fragment,f),i=!0)},o:function(f){M(n.$$.fragment,f),i=!1},d:function(f){t&&t.d(f),f&&m(e),Q(n,f)}};return j("SvelteRegisterBlock",{block:o,id:Ce.name,type:"if",source:"(152:32) ",ctx:l}),o}function Le(l){let e,n;const i={c:function(){e=C("p"),n=R("Loading ..."),this.h()},l:function(o){e=L(o,"P",{});var r=I(e);n=A(r,"Loading ..."),r.forEach(m),this.h()},h:function(){P(e,N,150,8,5438)},m:function(o,r){k(o,e,r),J(e,n)},p:z,i:z,o:z,d:function(o){o&&m(e)}};return j("SvelteRegisterBlock",{block:i,id:Le.name,type:"if",source:"(150:6) {#if step === 'LOADING'}",ctx:l}),i}function Ie(l){let e;const n={c:function(){e=R("Add Member")},l:function(t){e=A(t,"Add Member")},m:function(t,o){k(t,e,o)},d:function(t){t&&m(e)}};return j("SvelteRegisterBlock",{block:n,id:Ie.name,type:"slot",source:'(186:12) <PanelButton on:click={addMember} label=\\"Add Member\\">',ctx:l}),n}function Pe(l){let e;const n={c:function(){e=R("Leave Your Own Alliance")},l:function(t){e=A(t,"Leave Your Own Alliance")},m:function(t,o){k(t,e,o)},d:function(t){t&&m(e)}};return j("SvelteRegisterBlock",{block:n,id:Pe.name,type:"slot",source:'(191:10) <PanelButton on:click={leave} label=\\"Join\\">',ctx:l}),n}function Ne(l){let e;const n={c:function(){e=R("Request to Join")},l:function(t){e=A(t,"Request to Join")},m:function(t,o){k(t,e,o)},d:function(t){t&&m(e)}};return j("SvelteRegisterBlock",{block:n,id:Ne.name,type:"slot",source:'(162:10) <PanelButton on:click={join} label=\\"Join\\">',ctx:l}),n}function ue(l){let e,n,i,t,o,r,f;const a={c:function(){e=C("p"),n=R("Copy this string and send it to the admin:"),i=W(),t=C("pre"),o=R(l[2]),this.h()},l:function(d){e=L(d,"P",{});var b=I(e);n=A(b,"Copy this string and send it to the admin:"),b.forEach(m),i=T(d),t=L(d,"PRE",{class:!0});var w=I(t);o=A(w,l[2]),w.forEach(m),this.h()},h:function(){P(e,N,165,10,5963),K(t,"class","bg-blue-800 text-white"),P(t,N,166,10,6023)},m:function(d,b){k(d,e,b),J(e,n),k(d,i,b),k(d,t,b),J(t,o),r||(f=se(t,"click",Ge,!1,!1,!1),r=!0)},p:function(d,b){b&4&&oe(o,d[2])},d:function(d){d&&m(e),d&&m(i),d&&m(t),r=!1,f()}};return j("SvelteRegisterBlock",{block:a,id:ue.name,type:"if",source:"(165:8) {#if signedMessage}",ctx:l}),a}function Je(l){let e;const n={c:function(){e=R("Leave Alliance")},l:function(t){e=A(t,"Leave Alliance")},m:function(t,o){k(t,e,o)},d:function(t){t&&m(e)}};return j("SvelteRegisterBlock",{block:n,id:Je.name,type:"slot",source:'(176:10) <PanelButton on:click={leave} label=\\"Join\\">',ctx:l}),n}function me(l){let e;const n={c:function(){e=R(l[3])},l:function(t){e=A(t,l[3])},m:function(t,o){k(t,e,o)},p:function(t,o){o&8&&oe(e,t[3])},d:function(t){t&&m(e)}};return j("SvelteRegisterBlock",{block:n,id:me.name,type:"if",source:"(153:8) {#if error}",ctx:l}),n}function Fe(l){let e;const n={c:function(){e=R("load")},l:function(t){e=A(t,"load")},m:function(t,o){k(t,e,o)},d:function(t){t&&m(e)}};return j("SvelteRegisterBlock",{block:n,id:Fe.name,type:"slot",source:'(156:8) <PanelButton on:click={() => flow.connect()} label=\\"load\\">',ctx:l}),n}function Oe(l){let e,n;const i={c:function(){e=C("p"),n=R("Maybe you want to create your own alliance?"),this.h()},l:function(o){e=L(o,"P",{class:!0});var r=I(e);n=A(r,"Maybe you want to create your own alliance?"),r.forEach(m),this.h()},h:function(){K(e,"class","m-8"),P(e,N,197,8,7213)},m:function(o,r){k(o,e,r),J(e,n)},d:function(o){o&&m(e)}};return j("SvelteRegisterBlock",{block:i,id:Oe.name,type:"else",source:"(197:6) {:else}",ctx:l}),i}function Ve(l){let e,n;const i={c:function(){e=C("p"),n=R("Maybe you want to create a new alliance?"),this.h()},l:function(o){e=L(o,"P",{class:!0});var r=I(e);n=A(r,"Maybe you want to create a new alliance?"),r.forEach(m),this.h()},h:function(){K(e,"class","m-8"),P(e,N,195,8,7131)},m:function(o,r){k(o,e,r),J(e,n)},d:function(o){o&&m(e)}};return j("SvelteRegisterBlock",{block:i,id:Ve.name,type:"if",source:"(195:6) {#if admin && $wallet.address?.toLowerCase() === admin}",ctx:l}),i}function We(l){let e;const n={c:function(){e=R("Create")},l:function(t){e=A(t,"Create")},m:function(t,o){k(t,e,o)},d:function(t){t&&m(e)}};return j("SvelteRegisterBlock",{block:n,id:We.name,type:"slot",source:'(206:10) <PanelButton on:click={create} label=\\"Create\\">',ctx:l}),n}function Te(l){let e;const n={c:function(){e=R("Connect")},l:function(t){e=A(t,"Connect")},m:function(t,o){k(t,e,o)},d:function(t){t&&m(e)}};return j("SvelteRegisterBlock",{block:n,id:Te.name,type:"slot",source:'(142:6) <PanelButton on:click={connect} label=\\"Connect\\">',ctx:l}),n}function Ye(l){let e,n,i,t;const o=[Ae,Re],r=[];function f(u,d){return u[6].state!=="Ready"?0:1}n=f(l),i=r[n]=o[n](l);const a={c:function(){e=C("div"),i.c(),this.h()},l:function(d){e=L(d,"DIV",{class:!0});var b=I(e);i.l(b),b.forEach(m),this.h()},h:function(){K(e,"class","m-2"),P(e,N,139,2,5006)},m:function(d,b){k(d,e,b),r[n].m(e,null),t=!0},p:function(d,b){let w=n;n=f(d),n===w?r[n].p(d,b):(ne(),M(r[w],1,1,()=>{r[w]=null}),te(),i=r[n],i?i.p(d,b):(i=r[n]=o[n](d),i.c()),E(i,1),i.m(e,null))},i:function(d){t||(E(i),t=!0)},o:function(d){M(i),t=!1},d:function(d){d&&m(e),r[n].d()}};return j("SvelteRegisterBlock",{block:a,id:Ye.name,type:"slot",source:"(139:0) <WalletAccess>",ctx:l}),a}function de(l){let e,n;e=new je({$$inline:!0});const i={c:function(){q(e.$$.fragment)},l:function(o){G(e.$$.fragment,o)},m:function(o,r){H(e,o,r),n=!0},i:function(o){n||(E(e.$$.fragment,o),n=!0)},o:function(o){M(e.$$.fragment,o),n=!1},d:function(o){Q(e,o)}};return j("SvelteRegisterBlock",{block:i,id:de.name,type:"if",source:"(214:0) {#if $messageFlow.error || $messageFlow.step !== 'IDLE'}",ctx:l}),i}function pe(l){let e,n,i,t;e=new ye({props:{$$slots:{default:[Ye]},$$scope:{ctx:l}},$$inline:!0});let o=(l[7].error||l[7].step!=="IDLE")&&de(l);const r={c:function(){q(e.$$.fragment),n=W(),o&&o.c(),i=ge()},l:function(a){G(e.$$.fragment,a),n=T(a),o&&o.l(a),i=ge()},m:function(a,u){H(e,a,u),k(a,n,u),o&&o.m(a,u),k(a,i,u),t=!0},p:function(a,[u]){const d={};u&524415&&(d.$$scope={dirty:u,ctx:a}),e.$set(d),a[7].error||a[7].step!=="IDLE"?o?u&128&&E(o,1):(o=de(a),o.c(),E(o,1),o.m(i.parentNode,i)):o&&(ne(),M(o,1,1,()=>{o=null}),te())},i:function(a){t||(E(e.$$.fragment,a),E(o),t=!0)},o:function(a){M(e.$$.fragment,a),M(o),t=!1},d:function(a){Q(e,a),a&&m(n),o&&o.d(a),a&&m(i)}};return j("SvelteRegisterBlock",{block:r,id:pe.name,type:"component",source:"",ctx:l}),r}function qe(l){const e=document.createRange(),n=window.getSelection();e.selectNodeContents(l),console.log({selection:e.toString()}),n.removeAllRanges(),n.addRange(e)}function Ge(l){qe(l.currentTarget)}function xe(l,e,n){let i,t;be(Y,"wallet"),$e(l,Y,p=>n(6,i=p)),be(ie,"messageFlow"),$e(l,ie,p=>n(7,t=p));let{$$slots:o={},$$scope:r}=e;Ue("Basic_alliances",o,[]);function f(){Z.connect()}function a(){Y.disconnect()}async function u(){await Z.execute(async p=>{const S=he.createRandom().privateKey,O=await p.BasicAllianceFactory.getAddress(S),X=`Join Alliance ${ee(O.toLowerCase(),20)}`,le=await Y.provider.getSigner().signMessage(X);await p.BasicAllianceFactory.instantiate(Y.address,[{addr:Y.address,nonce:0,signature:le}],S)})}async function d(){await Z.execute(async p=>{const S=await p.AllianceRegistry.callStatic.getAllianceData(Y.address,g);if(S.joinTime.gt(0))throw new Error("already in alliance");let O=`Join Alliance ${ee(g.toLowerCase(),20)}`;S.nonce.gt(0)&&(O=`Join Alliance ${ee(g.toLowerCase(),20)} (nonce: ${(""+S.nonce.toNumber()).padStart(10," ")})`),console.log({message:O});const X=await Y.provider.getSigner().signMessage(O);n(2,F=Y.address+":"+O+":"+X)})}async function b(){await Z.execute(async p=>{await p.AllianceRegistry.leaveAlliance(g)})}async function w(){await Z.execute(async p=>{const S=B.replace(/^\s+|\s+$/g,"").replace("nonce:","nonce$").split(":").map(x=>x.replace("nonce$","nonce:"));let O=0;const X=B.indexOf("nonce:");if(X>=0){const x=B.slice(X+6,X+6+11).trim();console.log({nonceStr:x}),O=parseInt(x)}const le=S[0],He=S[1],_e=S[2];console.log({message:He,signature:_e}),await new ce(g,re.contracts.BasicAllianceFactory.abi,Y.provider.getSigner()).addMembers([{addr:le,nonce:O,signature:_e}])})}let D;async function h(){if(!g){n(4,v=void 0),n(5,y="READY");return}if(D&&D.state==="Ready"){if(y!="READY"||g&&!v){n(5,y="LOADING");try{const p=new ce(g,re.contracts.BasicAllianceFactory.abi,Y.provider);n(4,v=(await p.admin()).toLowerCase())}catch(p){n(5,y="IDLE"),n(3,V=Be(p))}v&&n(5,y="READY")}}else n(4,v=void 0),n(5,y="IDLE")}let g;ke(()=>{n(0,g=we.id),h()});let B,F,V,v,y="IDLE";Y.subscribe(async p=>{D=p,h()});const _=[];Object.keys(e).forEach(p=>{!~_.indexOf(p)&&p.slice(0,2)!=="$$"&&p!=="slot"&&Ze.warn(`<Basic_alliances> was created with unknown prop '${p}'`)});const c=()=>Z.connect(),s=()=>ie.show(v);function $(){B=this.value,n(1,B)}return l.$capture_state=()=>({PanelButton:U,onMount:ke,hashParams:we,Blockie:ae,WalletAccess:ye,flow:Z,wallet:Y,Contract:ce,hexZeroPad:ee,contractsInfos:re,formatError:Be,messageFlow:ie,MessageFlow:je,Wallet:he,connect:f,disconnect:a,create:u,join:d,leave:b,addMember:w,lastWalletState:D,update:h,id:g,joinMessage:B,signedMessage:F,error:V,admin:v,step:y,_select:qe,select:Ge,$wallet:i,$messageFlow:t}),l.$inject_state=p=>{"lastWalletState"in p&&(D=p.lastWalletState),"id"in p&&n(0,g=p.id),"joinMessage"in p&&n(1,B=p.joinMessage),"signedMessage"in p&&n(2,F=p.signedMessage),"error"in p&&n(3,V=p.error),"admin"in p&&n(4,v=p.admin),"step"in p&&n(5,y=p.step)},e&&"$$inject"in e&&l.$inject_state(e.$$inject),[g,B,F,V,v,y,i,t,f,a,u,d,b,w,c,s,$]}class Et extends Qe{constructor(e){super(e);ze(this,e,xe,pe,Ke,{}),j("SvelteRegisterComponent",{component:this,tagName:"Basic_alliances",options:e,id:pe.name})}}export{Et as default};
//# sourceMappingURL=basic-alliances.svelte-cbff5d3b.js.map
