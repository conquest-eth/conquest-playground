import{S as Ue,i as Ve,s as Ce,d as K,O as $e,P as Ie,v as Ke,Q as qe,z as ue,n as O,p as Se,A as fe,q as W,B as de,k as L,u as J,w as ze,x as Z,E as me,g as _,e as g,t as V,c as k,f as $,l as C,h as d,j as y,L as p,at as Q,M as pe,T as Qe,r as Xe,m as Be}from"../chunks/vendor-e78c39f1.js";import{a as he,l as je}from"../chunks/account-c0a26acd.js";import{p as Re,e as He}from"../chunks/privateWallet-7a0cfca0.js";import{c as ge,w as be,a as xe}from"../chunks/wallet-c826be1b.js";import{W as Oe}from"../chunks/WalletAccess-ec429ef9.js";import{M as ke}from"../chunks/Modal-a8884379.js";import{P as ye}from"../chunks/PanelButton-b24a8fdb.js";import{s as We}from"../chunks/spaceInfo-b394211b.js";import"../chunks/config-af7f3a10.js";import"../chunks/contracts-69d01f63.js";import"../chunks/paths-28a87002.js";import"../chunks/NavButton-b22b61c0.js";import"../chunks/base-652be6d9.js";const{console:Ye}=qe,w="src/routes/recover.svelte";function Ae(r){let e,t,n,o,s,i,u,h,m,l,a,c,v,B,M,ne,S,oe,N,F,se,ae,f,X,A,R,le,Y,E,q,I,z,ce,re;const _e={c:function(){e=g("div"),t=g("div"),n=g("form"),o=g("h1"),s=V("Recover Fleet"),i=O(),u=g("div"),h=g("label"),m=V("Transaction Hash"),l=O(),a=g("input"),c=O(),v=g("div"),B=g("label"),M=V("Destination"),ne=O(),S=g("input"),oe=O(),N=g("div"),F=g("label"),se=V("arrivalTimeWanted"),ae=O(),f=g("input"),X=O(),A=g("div"),R=g("label"),le=V("specific"),Y=O(),E=g("input"),q=O(),I=g("button"),z=V("Recover"),this.h()},l:function(T){e=k(T,"DIV",{class:!0});var H=$(e);t=k(H,"DIV",{class:!0});var j=$(t);n=k(j,"FORM",{class:!0});var b=$(n);o=k(b,"H1",{class:!0});var te=$(o);s=C(te,"Recover Fleet"),te.forEach(_),i=W(b),u=k(b,"DIV",{});var G=$(u);h=k(G,"LABEL",{class:!0,for:!0});var ie=$(h);m=C(ie,"Transaction Hash"),ie.forEach(_),l=W(G),a=k(G,"INPUT",{class:!0,type:!0,name:!0,id:!0,placeholder:!0}),G.forEach(_),c=W(b),v=k(b,"DIV",{});var P=$(v);B=k(P,"LABEL",{class:!0,for:!0});var D=$(B);M=C(D,"Destination"),D.forEach(_),ne=W(P),S=k(P,"INPUT",{class:!0,type:!0,name:!0,id:!0,placeholder:!0}),P.forEach(_),oe=W(b),N=k(b,"DIV",{});var x=$(N);F=k(x,"LABEL",{class:!0,for:!0});var U=$(F);se=C(U,"arrivalTimeWanted"),U.forEach(_),ae=W(x),f=k(x,"INPUT",{class:!0,type:!0,name:!0,id:!0}),x.forEach(_),X=W(b),A=k(b,"DIV",{});var ve=$(A);R=k(ve,"LABEL",{class:!0,for:!0});var Te=$(R);le=C(Te,"specific"),Te.forEach(_),Y=W(ve),E=k(ve,"INPUT",{class:!0,type:!0,name:!0,id:!0}),ve.forEach(_),q=W(b),I=k(b,"BUTTON",{type:!0,class:!0});var Ee=$(I);z=C(Ee,"Recover"),Ee.forEach(_),b.forEach(_),j.forEach(_),H.forEach(_),this.h()},h:function(){d(o,"class","text-center text-2xl mb-6 text-gray-300 font-bold font-sans"),y(o,w,152,8,6856),d(h,"class","text-gray-100 font-semibold block my-3 text-md"),d(h,"for","transactionHash"),y(h,w,154,10,6971),d(a,"class","w-full bg-gray-800 px-4 py-2 rounded-lg focus:outline-none"),d(a,"type","text"),d(a,"name","transactionHash"),d(a,"id","transactionHash"),d(a,"placeholder","transactionHash"),y(a,w,155,10,7090),y(u,w,153,8,6955),d(B,"class","text-gray-100 font-semibold block my-3 text-md"),d(B,"for","destination"),y(B,w,175,10,7745),d(S,"class","w-full bg-gray-800 px-4 py-2 rounded-lg focus:outline-none"),d(S,"type","text"),d(S,"name","destination"),d(S,"id","destination"),d(S,"placeholder","destination"),y(S,w,176,10,7855),y(v,w,174,8,7729),d(F,"class","text-gray-100 font-semibold block my-3 text-md"),d(F,"for","arrivalTimeWanted"),y(F,w,186,10,8152),d(f,"class","w-full bg-gray-800 px-4 py-2 rounded-lg focus:outline-none"),d(f,"type","text"),d(f,"name","arrivalTimeWanted"),d(f,"id","arrivalTimeWanted"),y(f,w,188,10,8285),y(N,w,185,8,8136),d(R,"class","text-gray-100 font-semibold block my-3 text-md"),d(R,"for","specific"),y(R,w,197,10,8562),d(E,"class","w-full bg-gray-800 px-4 py-2 rounded-lg focus:outline-none"),d(E,"type","text"),d(E,"name","specific"),d(E,"id","specific"),y(E,w,198,10,8666),y(A,w,196,8,8546),d(I,"type","submit"),d(I,"class","w-full mt-6 bg-indigo-600 rounded-lg px-4 py-2 text-lg text-white tracking-wide font-semibold font-sans"),y(I,w,228,8,9548),d(n,"class","bg-black p-10 rounded-lg shadow-lg min-w-full"),y(n,w,151,6,6787),d(t,"class","lg:w-2/5 md:w-1/2 w-2/3"),y(t,w,150,4,6743),d(e,"class","h-screen flex justify-center items-center"),y(e,w,149,2,6683)},m:function(T,H){L(T,e,H),p(e,t),p(t,n),p(n,o),p(o,s),p(n,i),p(n,u),p(u,h),p(h,m),p(u,l),p(u,a),Q(a,r[1]),p(n,c),p(n,v),p(v,B),p(B,M),p(v,ne),p(v,S),Q(S,r[0]),p(n,oe),p(n,N),p(N,F),p(F,se),p(N,ae),p(N,f),Q(f,r[4]),p(n,X),p(n,A),p(A,R),p(R,le),p(A,Y),p(A,E),Q(E,r[5]),p(n,q),p(n,I),p(I,z),ce||(re=[pe(a,"input",r[9]),pe(S,"input",r[10]),pe(f,"input",r[11]),pe(E,"input",r[12]),pe(I,"click",r[8],!1,!1,!1)],ce=!0)},p:function(T,H){H&2&&a.value!==T[1]&&Q(a,T[1]),H&1&&S.value!==T[0]&&Q(S,T[0]),H&16&&f.value!==T[4]&&Q(f,T[4]),H&32&&E.value!==T[5]&&Q(E,T[5])},d:function(T){T&&_(e),ce=!1,Qe(re)}};return K("SvelteRegisterBlock",{block:_e,id:Ae.name,type:"slot",source:"(149:0) <WalletAccess>",ctx:r}),_e}function De(r){let e,t;e=new ke({props:{title:"Success",$$slots:{default:[Ne]},$$scope:{ctx:r}},$$inline:!0}),e.$on("close",r[14]);const n={c:function(){ue(e.$$.fragment)},l:function(s){fe(e.$$.fragment,s)},m:function(s,i){de(e,s,i),t=!0},p:function(s,i){const u={};i&131080&&(u.$$scope={dirty:i,ctx:s}),e.$set(u)},i:function(s){t||(Z(e.$$.fragment,s),t=!0)},o:function(s){J(e.$$.fragment,s),t=!1},d:function(s){me(e,s)}};return K("SvelteRegisterBlock",{block:n,id:De.name,type:"if",source:"(254:18) ",ctx:r}),n}function Le(r){let e,t;e=new ke({props:{title:"An error occured!",$$slots:{default:[Pe]},$$scope:{ctx:r}},$$inline:!0}),e.$on("close",r[13]);const n={c:function(){ue(e.$$.fragment)},l:function(s){fe(e.$$.fragment,s)},m:function(s,i){de(e,s,i),t=!0},p:function(s,i){const u={};i&131076&&(u.$$scope={dirty:i,ctx:s}),e.$set(u)},i:function(s){t||(Z(e.$$.fragment,s),t=!0)},o:function(s){J(e.$$.fragment,s),t=!1},d:function(s){me(e,s)}};return K("SvelteRegisterBlock",{block:n,id:Le.name,type:"if",source:"(240:0) {#if error}",ctx:r}),n}function Me(r){let e;const t={c:function(){e=V("Ok")},l:function(o){e=C(o,"Ok")},m:function(o,s){L(o,e,s)},d:function(o){o&&_(e)}};return K("SvelteRegisterBlock",{block:t,id:Me.name,type:"slot",source:'(265:6) <Button class=\\"mt-4 text-center\\" label=\\"OK\\" on:click={acknowledgeSuccess}>',ctx:r}),t}function Ne(r){let e,t,n,o,s,i,u;i=new ye({props:{class:"mt-4 text-center",label:"OK",$$slots:{default:[Me]},$$scope:{ctx:r}},$$inline:!0}),i.$on("click",r[6]);const h={c:function(){e=g("ul"),t=g("li"),n=V(r[3]),o=O(),s=g("div"),ue(i.$$.fragment),this.h()},l:function(l){e=k(l,"UL",{class:!0});var a=$(e);t=k(a,"LI",{});var c=$(t);n=C(c,r[3]),c.forEach(_),a.forEach(_),o=W(l),s=k(l,"DIV",{class:!0});var v=$(s);fe(i.$$.fragment,v),v.forEach(_),this.h()},h:function(){y(t,w,261,6,10285),d(e,"class","mt-10 text-white"),y(e,w,260,4,10249),d(s,"class","text-center"),y(s,w,263,4,10318)},m:function(l,a){L(l,e,a),p(e,t),p(t,n),L(l,o,a),L(l,s,a),de(i,s,null),u=!0},p:function(l,a){(!u||a&8)&&Be(n,l[3]);const c={};a&131072&&(c.$$scope={dirty:a,ctx:l}),i.$set(c)},i:function(l){u||(Z(i.$$.fragment,l),u=!0)},o:function(l){J(i.$$.fragment,l),u=!1},d:function(l){l&&_(e),l&&_(o),l&&_(s),me(i)}};return K("SvelteRegisterBlock",{block:h,id:Ne.name,type:"slot",source:'(255:2) <Modal     title=\\"Success\\"     on:close={() => {       success = undefined;     }}   >',ctx:r}),h}function Fe(r){let e;const t={c:function(){e=V("Ok")},l:function(o){e=C(o,"Ok")},m:function(o,s){L(o,e,s)},d:function(o){o&&_(e)}};return K("SvelteRegisterBlock",{block:t,id:Fe.name,type:"slot",source:'(251:6) <Button class=\\"mt-4 text-center\\" label=\\"OK\\" on:click={acknowledgeError}>',ctx:r}),t}function Pe(r){let e,t,n,o,s,i,u;i=new ye({props:{class:"mt-4 text-center",label:"OK",$$slots:{default:[Fe]},$$scope:{ctx:r}},$$inline:!0}),i.$on("click",r[7]);const h={c:function(){e=g("ul"),t=g("li"),n=V(r[2]),o=O(),s=g("div"),ue(i.$$.fragment),this.h()},l:function(l){e=k(l,"UL",{class:!0});var a=$(e);t=k(a,"LI",{});var c=$(t);n=C(c,r[2]),c.forEach(_),a.forEach(_),o=W(l),s=k(l,"DIV",{class:!0});var v=$(s);fe(i.$$.fragment,v),v.forEach(_),this.h()},h:function(){y(t,w,247,6,9968),d(e,"class","mt-10 text-white"),y(e,w,246,4,9932),d(s,"class","text-center"),y(s,w,249,4,9999)},m:function(l,a){L(l,e,a),p(e,t),p(t,n),L(l,o,a),L(l,s,a),de(i,s,null),u=!0},p:function(l,a){(!u||a&4)&&Be(n,l[2]);const c={};a&131072&&(c.$$scope={dirty:a,ctx:l}),i.$set(c)},i:function(l){u||(Z(i.$$.fragment,l),u=!0)},o:function(l){J(i.$$.fragment,l),u=!1},d:function(l){l&&_(e),l&&_(o),l&&_(s),me(i)}};return K("SvelteRegisterBlock",{block:h,id:Pe.name,type:"slot",source:'(241:2) <Modal     title=\\"An error occured!\\"     on:close={() => {       error = undefined;     }}   >',ctx:r}),h}function we(r){let e,t,n,o,s,i;e=new Oe({props:{$$slots:{default:[Ae]},$$scope:{ctx:r}},$$inline:!0});const u=[Le,De],h=[];function m(a,c){return a[2]?0:a[3]?1:-1}~(n=m(r))&&(o=h[n]=u[n](r));const l={c:function(){ue(e.$$.fragment),t=O(),o&&o.c(),s=Se()},l:function(c){fe(e.$$.fragment,c),t=W(c),o&&o.l(c),s=Se()},m:function(c,v){de(e,c,v),L(c,t,v),~n&&h[n].m(c,v),L(c,s,v),i=!0},p:function(c,[v]){const B={};v&131123&&(B.$$scope={dirty:v,ctx:c}),e.$set(B);let M=n;n=m(c),n===M?~n&&h[n].p(c,v):(o&&(Xe(),J(h[M],1,1,()=>{h[M]=null}),ze()),~n?(o=h[n],o?o.p(c,v):(o=h[n]=u[n](c),o.c()),Z(o,1),o.m(s.parentNode,s)):o=null)},i:function(c){i||(Z(e.$$.fragment,c),Z(o),i=!0)},o:function(c){J(e.$$.fragment,c),J(o),i=!1},d:function(c){me(e,c),c&&_(t),~n&&h[n].d(c),c&&_(s)}};return K("SvelteRegisterBlock",{block:l,id:we.name,type:"component",source:"",ctx:r}),l}function Ge(r,e,t){let n,o;$e(he,"account"),Ie(r,he,f=>t(15,n=f)),$e(ge,"chain"),Ie(r,ge,f=>t(16,o=f));let{$$slots:s={},$$scope:i}=e;Ke("Recover",s,[]);let u,h,m,l,a=0,c="";function v(){t(3,l=void 0)}function B(){t(2,m=void 0)}async function M(f){f.preventDefault(),Re.execute(async()=>{const X=await be.provider.getTransaction(h),A=await be.provider.getTransactionReceipt(h),R=await be.provider.getBlock(A.blockHash),le=o.contracts.OuterSpace.interface,Y=A.logs.reduce((E,q)=>{let I;try{I=le.parseLog(q)}catch(z){console.error(z)}return I&&E.push(I),E},[]).filter(E=>E.name==="FleetSent");Y.length==0&&t(2,m="No Fleet matching that tx are found"),console.log(Y);for(const E of Y){const{fleet:q,fleetOwner:I,fleetSender:z,from:ce,operator:re,quantity:_e,newNumSpaceships:ee}=E.args;let T;try{if(T=He(u),!We.getPlanetInfo(T.x,T.y)){t(2,m=`no planet at (${T.x},${T.y})`);return}}catch{t(2,m="invalid coords");return}const H=je(ce.toHexString());let j;for(let b=Math.max(0,X.nonce-1);b<X.nonce+5;b++){for(let te=0;te<2;te++){const G=te==0,ie=c===""?"0x0000000000000000000000000000000000000001":c,P=[a];if(a===0){const D=64,x=Math.floor(R.timestamp/60)*60-Math.floor(D/2)*60;for(let U=0;U<D;U++)P.push(x+U*60);console.log({listOfArrivalTimeWanted:P})}else if(a==-1){const D=512,x=Math.floor(R.timestamp/60)*60-Math.floor(D/2)*60;for(let U=0;U<D;U++)P.push(x+U*60);console.log({listOfArrivalTimeWanted:P})}for(const D of P){const x=await he.hashFleet(H,T,G,ie,D,b,I,z,re);if(x.fleetId==q.toHexString()){j={fleet:{fleetAmount:_e,from:H,to:T,gift:G,arrivalTimeWanted:D,id:x.fleetId,owner:I,specific:ie,fleetSender:z,operator:re},nonce:b,txHash:X.hash,timestamp:R.timestamp,overrideTimestamp:xe()},console.log("found!!!!!!!!!!!!!!!!!!!!");break}console.error(`fleetID generated: ${x.fleetId} not matching expected fleetID ${q.toHexString()} `)}if(j)break}if(j)break}if(j)try{if(!(n==null?void 0:n.data))t(2,m="Account not available, please reload");else{const b=n.data.pendingActions[j.txHash];b&&typeof b!="number"?t(2,m="already recovered"):he.recordFleet(j.fleet,j.txHash,j.timestamp,j.nonce,j.overrideTimestamp)}}catch(b){t(2,m=b)}else t(2,m="no fleet matching")}})}const ne=[];Object.keys(e).forEach(f=>{!~ne.indexOf(f)&&f.slice(0,2)!=="$$"&&f!=="slot"&&Ye.warn(`<Recover> was created with unknown prop '${f}'`)});function S(){h=this.value,t(1,h)}function oe(){u=this.value,t(0,u)}function N(){a=this.value,t(4,a)}function F(){c=this.value,t(5,c)}const se=()=>{t(2,m=void 0)},ae=()=>{t(3,l=void 0)};return r.$capture_state=()=>({account:he,privateWallet:Re,chain:ge,wallet:be,WalletAccess:Oe,Modal:ke,Button:ye,spaceInfo:We,now:xe,decodeCoords:He,locationToXY:je,destination:u,transactionHash:h,error:m,success:l,arrivalTimeWanted:a,specific:c,acknowledgeSuccess:v,acknowledgeError:B,recover:M,$account:n,$chain:o}),r.$inject_state=f=>{"destination"in f&&t(0,u=f.destination),"transactionHash"in f&&t(1,h=f.transactionHash),"error"in f&&t(2,m=f.error),"success"in f&&t(3,l=f.success),"arrivalTimeWanted"in f&&t(4,a=f.arrivalTimeWanted),"specific"in f&&t(5,c=f.specific)},e&&"$$inject"in e&&r.$inject_state(e.$$inject),[u,h,m,l,a,c,v,B,M,S,oe,N,F,se,ae]}class ft extends Ue{constructor(e){super(e);Ve(this,e,Ge,we,Ce,{}),K("SvelteRegisterComponent",{component:this,tagName:"Recover",options:e,id:we.name})}}export{ft as default};
//# sourceMappingURL=recover.svelte-43d4dba6.js.map
