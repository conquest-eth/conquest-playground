import{a5 as me,S as He,i as We,s as Ce,d as ie,O as Be,P as Ee,v as Me,o as Se,e as I,z as ne,n as S,t as $,c as L,f as q,A as le,q as N,l as _,g as m,h as D,j as G,k as M,B as oe,L as o,u as X,w as _e,x as Q,E as se,ag as de,m as ee,r as ve,ai as Ne,N as fe}from"../chunks/vendor-e78c39f1.js";import{b as Pe}from"../chunks/paths-28a87002.js";import{w as ke}from"../chunks/wallet-c826be1b.js";import{B as ge}from"../chunks/Blockie-6a051512.js";import{N as Te}from"../chunks/NavButton-b22b61c0.js";import{P as ce}from"../chunks/PlayCoin-69d24b1d.js";import{b as qe}from"../chunks/base-652be6d9.js";import{B as Oe}from"../chunks/config-af7f3a10.js";import{S as Ue}from"../chunks/subgraph-aa394bde.js";import"../chunks/contracts-69d01f63.js";import"../chunks/Copiable-f9ca3aee.js";const pe=me.from("1000000000000000000");class Ve extends qe{constructor(){super({step:"IDLE"})}async fetch(){const e=`
query($first: Int! $lastId: ID!) {
  owners(first: $first block: {number: 21538868} where: {
    totalStaked_gt: 0
    tokenGiven_gt: 0
    id_gt: $lastId
  }) {
    id
    currentStake
    tokenToWithdraw
    tokenBalance
    tokenGiven
  }
}
`;try{let a;try{a=await Ue.queryList(e,{path:"owners",context:{requestPolicy:"network-only"}})}catch(s){throw console.error(s),this.setPartial({error:"cannot fetch from thegraph node"}),new Error("cannot fetch from thegraph node")}const f=a.map(s=>{const u=me.from(s.currentStake),h=me.from(s.tokenToWithdraw),p=me.from(s.tokenBalance),g=me.from(s.tokenGiven),w=u.add(h).add(p);return{id:s.id,total:w.div(pe).toNumber(),score:w.sub(g).mul(1e6).div(g).add(1e6).toNumber(),currentStake:u.div(pe).toNumber(),tokenToWithdraw:h.div(pe).toNumber(),tokenBalance:p.div(pe).toNumber(),tokenGiven:g.div(pe).toNumber()}}).sort((s,u)=>u.score-s.score);this.setPartial({step:"READY",data:f})}catch(a){console.error(a)}this.timeout=setTimeout(this.fetch.bind(this),Oe*1e3)}start(){this.$store.step==="IDLE"&&this.setPartial({step:"LOADING"}),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.fetch.bind(this),1e3)}stop(){this.setPartial({step:"IDLE"}),this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0)}}const $e=new Ve,R="src/routes/highscores.svelte";function Ie(c,e,a){const f=c.slice();return f[2]=e[a],f[4]=a,f}function Le(c,e,a){const f=c.slice();return f[2]=e[a],f[4]=a,f}function De(c){let e;const a={c:function(){e=$("Back To Game")},l:function(s){e=_(s,"Back To Game")},m:function(s,u){M(s,e,u)},d:function(s){s&&m(e)}};return ie("SvelteRegisterBlock",{block:a,id:De.name,type:"slot",source:'(16:2) <NavButton label=\\"Back To Game\\" href={`${base}/`}>',ctx:c}),a}function Ge(c){let e,a,f,s,u,h,p,g,w,H,Y,j,F,J,W,O,C,U,B=c[0].data.slice(0,18);de(B);let k=[];for(let d=0;d<B.length;d+=1)k[d]=we(Le(c,B,d));const P=d=>X(k[d],1,1,()=>{k[d]=null});let b=c[0].data.slice(18);de(b);let v=[];for(let d=0;d<b.length;d+=1)v[d]=be(Ie(c,b,d));const V=d=>X(v[d],1,1,()=>{v[d]=null}),z={c:function(){e=I("hr"),a=S(),f=I("p"),s=$("Top 18 Winning players"),u=S(),h=I("hr"),p=S(),g=I("ul");for(let t=0;t<k.length;t+=1)k[t].c();w=S(),H=I("hr"),Y=S(),j=I("p"),F=$("Non-winning players"),J=S(),W=I("hr"),O=S(),C=I("ul");for(let t=0;t<v.length;t+=1)v[t].c();this.h()},l:function(t){e=L(t,"HR",{class:!0}),a=N(t),f=L(t,"P",{});var r=q(f);s=_(r,"Top 18 Winning players"),r.forEach(m),u=N(t),h=L(t,"HR",{class:!0}),p=N(t),g=L(t,"UL",{});var n=q(g);for(let A=0;A<k.length;A+=1)k[A].l(n);n.forEach(m),w=N(t),H=L(t,"HR",{class:!0}),Y=N(t),j=L(t,"P",{});var E=q(j);F=_(E,"Non-winning players"),E.forEach(m),J=N(t),W=L(t,"HR",{class:!0}),O=N(t),C=L(t,"UL",{});var y=q(C);for(let A=0;A<v.length;A+=1)v[A].l(y);y.forEach(m),this.h()},h:function(){D(e,"class","my-4"),G(e,R,35,6,1617),G(f,R,36,6,1643),D(h,"class","my-4"),G(h,R,37,6,1679),G(g,R,38,6,1705),D(H,"class","my-4 mt-16"),G(H,R,62,6,2711),G(j,R,63,6,2743),D(W,"class","my-4"),G(W,R,64,6,2776),G(C,R,65,6,2802)},m:function(t,r){M(t,e,r),M(t,a,r),M(t,f,r),o(f,s),M(t,u,r),M(t,h,r),M(t,p,r),M(t,g,r);for(let n=0;n<k.length;n+=1)k[n].m(g,null);M(t,w,r),M(t,H,r),M(t,Y,r),M(t,j,r),o(j,F),M(t,J,r),M(t,W,r),M(t,O,r),M(t,C,r);for(let n=0;n<v.length;n+=1)v[n].m(C,null);U=!0},p:function(t,r){if(r&3){B=t[0].data.slice(0,18),de(B);let n;for(n=0;n<B.length;n+=1){const E=Le(t,B,n);k[n]?(k[n].p(E,r),Q(k[n],1)):(k[n]=we(E),k[n].c(),Q(k[n],1),k[n].m(g,null))}for(ve(),n=B.length;n<k.length;n+=1)P(n);_e()}if(r&1){b=t[0].data.slice(18),de(b);let n;for(n=0;n<b.length;n+=1){const E=Ie(t,b,n);v[n]?(v[n].p(E,r),Q(v[n],1)):(v[n]=be(E),v[n].c(),Q(v[n],1),v[n].m(C,null))}for(ve(),n=b.length;n<v.length;n+=1)V(n);_e()}},i:function(t){if(!U){for(let r=0;r<B.length;r+=1)Q(k[r]);for(let r=0;r<b.length;r+=1)Q(v[r]);U=!0}},o:function(t){k=k.filter(Boolean);for(let r=0;r<k.length;r+=1)X(k[r]);v=v.filter(Boolean);for(let r=0;r<v.length;r+=1)X(v[r]);U=!1},d:function(t){t&&m(e),t&&m(a),t&&m(f),t&&m(u),t&&m(h),t&&m(p),t&&m(g),Ne(k,t),t&&m(w),t&&m(H),t&&m(Y),t&&m(j),t&&m(J),t&&m(W),t&&m(O),t&&m(C),Ne(v,t)}};return ie("SvelteRegisterBlock",{block:z,id:Ge.name,type:"else",source:"(35:4) {:else}",ctx:c}),z}function Re(c){let e,a;const f={c:function(){e=I("span"),a=$("Loading..."),this.h()},l:function(u){e=L(u,"SPAN",{class:!0});var h=q(e);a=_(h,"Loading..."),h.forEach(m),this.h()},h:function(){D(e,"class","text-yellow-600"),G(e,R,33,6,1551)},m:function(u,h){M(u,e,h),o(e,a)},p:fe,i:fe,o:fe,d:function(u){u&&m(e)}};return ie("SvelteRegisterBlock",{block:f,id:Re.name,type:"if",source:"(33:45) ",ctx:c}),f}function Ae(c){let e,a;const f={c:function(){e=I("span"),a=$("Please wait..."),this.h()},l:function(u){e=L(u,"SPAN",{class:!0});var h=q(e);a=_(h,"Please wait..."),h.forEach(m),this.h()},h:function(){D(e,"class","text-yellow-600"),G(e,R,31,6,1447)},m:function(u,h){M(u,e,h),o(e,a)},p:fe,i:fe,o:fe,d:function(u){u&&m(e)}};return ie("SvelteRegisterBlock",{block:f,id:Ae.name,type:"if",source:"(31:42) ",ctx:c}),f}function je(c){let e,a=c[0].error+"",f;const s={c:function(){e=I("span"),f=$(a),this.h()},l:function(h){e=L(h,"SPAN",{class:!0});var p=q(e);f=_(p,a),p.forEach(m),this.h()},h:function(){D(e,"class","text-red-600"),G(e,R,29,6,1344)},m:function(h,p){M(h,e,p),o(e,f)},p:function(h,p){p&1&&a!==(a=h[0].error+"")&&ee(f,a)},i:fe,o:fe,d:function(h){h&&m(e)}};return ie("SvelteRegisterBlock",{block:s,id:je.name,type:"if",source:"(29:4) {#if $highscores.error}",ctx:c}),s}function we(c){let e,a,f=c[4]+1+"",s,u,h,p,g,w,H=c[2].id+"",Y,j,F=Math.floor(c[2].score/100)+"",J,W,O=c[2].total+"",C,U,B,k,P=c[2].tokenBalance+"",b,v,V,z,d=c[2].tokenToWithdraw+"",t,r,n,E,y=c[2].tokenGiven+"",A,ae,K,re,te,T;p=new ge({props:{class:"w-6 h-6 inline my-1/2 mr-2",address:c[2].id},$$inline:!0}),B=new ce({props:{class:"w-4 h-4 inline"},$$inline:!0}),V=new ce({props:{class:"w-4 h-4 inline"},$$inline:!0}),n=new ce({props:{class:"w-4 h-4 inline"},$$inline:!0}),K=new ce({props:{class:"w-4 h-4 inline"},$$inline:!0});const he={c:function(){e=I("li"),a=I("span"),s=$(f),u=$(":"),h=S(),ne(p.$$.fragment),g=S(),w=I("div"),Y=$(H),j=S(),J=$(F),W=$(`
            with
            `),C=$(O),U=S(),ne(B.$$.fragment),k=$(`
            in control, including
            `),b=$(P),v=S(),ne(V.$$.fragment),z=$(`
            left to spend and
            `),t=$(d),r=S(),ne(n.$$.fragment),E=$(`
            to withdraw (was given
            `),A=$(y),ae=S(),ne(K.$$.fragment),re=$(`)
          `),this.h()},l:function(i){e=L(i,"LI",{class:!0});var l=q(e);a=L(l,"SPAN",{class:!0});var x=q(a);s=_(x,f),u=_(x,":"),x.forEach(m),h=N(l),le(p.$$.fragment,l),g=N(l),w=L(l,"DIV",{class:!0,style:!0});var ue=q(w);Y=_(ue,H),ue.forEach(m),j=N(l),J=_(l,F),W=_(l,`
            with
            `),C=_(l,O),U=N(l),le(B.$$.fragment,l),k=_(l,`
            in control, including
            `),b=_(l,P),v=N(l),le(V.$$.fragment,l),z=_(l,`
            left to spend and
            `),t=_(l,d),r=N(l),le(n.$$.fragment,l),E=_(l,`
            to withdraw (was given
            `),A=_(l,y),ae=N(l),le(K.$$.fragment,l),re=_(l,`)
          `),l.forEach(m),this.h()},h:function(){var i;D(a,"class","w-10 inline-block"),G(a,R,41,12,1893),D(w,"class","w-6 h-6 text-xs mr-4 inline-block"),D(w,"style","white-space: nowrap;overflow: hidden;"),G(w,R,43,12,2036),D(e,"class",te=`${((i=c[1].address)==null?void 0:i.toLowerCase())===c[2].id?"font-black text-green-400":""}`),G(e,R,40,10,1783)},m:function(i,l){M(i,e,l),o(e,a),o(a,s),o(a,u),o(e,h),oe(p,e,null),o(e,g),o(e,w),o(w,Y),o(e,j),o(e,J),o(e,W),o(e,C),o(e,U),oe(B,e,null),o(e,k),o(e,b),o(e,v),oe(V,e,null),o(e,z),o(e,t),o(e,r),oe(n,e,null),o(e,E),o(e,A),o(e,ae),oe(K,e,null),o(e,re),T=!0},p:function(i,l){var ue;const x={};l&1&&(x.address=i[2].id),p.$set(x),(!T||l&1)&&H!==(H=i[2].id+"")&&ee(Y,H),(!T||l&1)&&F!==(F=Math.floor(i[2].score/100)+"")&&ee(J,F),(!T||l&1)&&O!==(O=i[2].total+"")&&ee(C,O),(!T||l&1)&&P!==(P=i[2].tokenBalance+"")&&ee(b,P),(!T||l&1)&&d!==(d=i[2].tokenToWithdraw+"")&&ee(t,d),(!T||l&1)&&y!==(y=i[2].tokenGiven+"")&&ee(A,y),(!T||l&3&&te!==(te=`${((ue=i[1].address)==null?void 0:ue.toLowerCase())===i[2].id?"font-black text-green-400":""}`))&&D(e,"class",te)},i:function(i){T||(Q(p.$$.fragment,i),Q(B.$$.fragment,i),Q(V.$$.fragment,i),Q(n.$$.fragment,i),Q(K.$$.fragment,i),T=!0)},o:function(i){X(p.$$.fragment,i),X(B.$$.fragment,i),X(V.$$.fragment,i),X(n.$$.fragment,i),X(K.$$.fragment,i),T=!1},d:function(i){i&&m(e),se(p),se(B),se(V),se(n),se(K)}};return ie("SvelteRegisterBlock",{block:he,id:we.name,type:"each",source:"(40:8) {#each $highscores.data.slice(0, 18) as player, index}",ctx:c}),he}function be(c){let e,a,f=c[4]+19+"",s,u,h,p,g,w,H=c[2].id+"",Y,j,F=Math.floor(c[2].score/100)+"",J,W,O=c[2].total+"",C,U,B,k,P=c[2].tokenBalance+"",b,v,V,z,d=c[2].tokenToWithdraw+"",t,r,n,E,y=c[2].tokenGiven+"",A,ae,K,re,te,T;p=new ge({props:{class:"w-6 h-6 inline my-1/2 mr-2",address:c[2].id},$$inline:!0}),B=new ce({props:{class:"w-4 h-4 inline"},$$inline:!0}),V=new ce({props:{class:"w-4 h-4 inline"},$$inline:!0}),n=new ce({props:{class:"w-4 h-4 inline"},$$inline:!0}),K=new ce({props:{class:"w-4 h-4 inline"},$$inline:!0});const he={c:function(){e=I("li"),a=I("span"),s=$(f),u=$(":"),h=S(),ne(p.$$.fragment),g=S(),w=I("div"),Y=$(H),j=S(),J=$(F),W=$(`
            with
            `),C=$(O),U=S(),ne(B.$$.fragment),k=$(`
            in control, including
            `),b=$(P),v=S(),ne(V.$$.fragment),z=$(`
            left to spend and
            `),t=$(d),r=S(),ne(n.$$.fragment),E=$(`
            to withdraw (was given
            `),A=$(y),ae=S(),ne(K.$$.fragment),re=$(`)
          `),this.h()},l:function(i){e=L(i,"LI",{class:!0});var l=q(e);a=L(l,"SPAN",{class:!0});var x=q(a);s=_(x,f),u=_(x,":"),x.forEach(m),h=N(l),le(p.$$.fragment,l),g=N(l),w=L(l,"DIV",{class:!0,style:!0});var ue=q(w);Y=_(ue,H),ue.forEach(m),j=N(l),J=_(l,F),W=_(l,`
            with
            `),C=_(l,O),U=N(l),le(B.$$.fragment,l),k=_(l,`
            in control, including
            `),b=_(l,P),v=N(l),le(V.$$.fragment,l),z=_(l,`
            left to spend and
            `),t=_(l,d),r=N(l),le(n.$$.fragment,l),E=_(l,`
            to withdraw (was given
            `),A=_(l,y),ae=N(l),le(K.$$.fragment,l),re=_(l,`)
          `),l.forEach(m),this.h()},h:function(){D(a,"class","w-10 inline-block"),G(a,R,68,12,2986),D(w,"class","w-6 h-6 text-xs mr-4 inline-block"),D(w,"style","white-space: nowrap;overflow: hidden;"),G(w,R,70,12,3130),D(e,"class",te=c[2].total==c[2].tokenToWithdraw+c[2].tokenBalance?"text-gray-500":""),G(e,R,67,10,2877)},m:function(i,l){M(i,e,l),o(e,a),o(a,s),o(a,u),o(e,h),oe(p,e,null),o(e,g),o(e,w),o(w,Y),o(e,j),o(e,J),o(e,W),o(e,C),o(e,U),oe(B,e,null),o(e,k),o(e,b),o(e,v),oe(V,e,null),o(e,z),o(e,t),o(e,r),oe(n,e,null),o(e,E),o(e,A),o(e,ae),oe(K,e,null),o(e,re),T=!0},p:function(i,l){const x={};l&1&&(x.address=i[2].id),p.$set(x),(!T||l&1)&&H!==(H=i[2].id+"")&&ee(Y,H),(!T||l&1)&&F!==(F=Math.floor(i[2].score/100)+"")&&ee(J,F),(!T||l&1)&&O!==(O=i[2].total+"")&&ee(C,O),(!T||l&1)&&P!==(P=i[2].tokenBalance+"")&&ee(b,P),(!T||l&1)&&d!==(d=i[2].tokenToWithdraw+"")&&ee(t,d),(!T||l&1)&&y!==(y=i[2].tokenGiven+"")&&ee(A,y),(!T||l&1&&te!==(te=i[2].total==i[2].tokenToWithdraw+i[2].tokenBalance?"text-gray-500":""))&&D(e,"class",te)},i:function(i){T||(Q(p.$$.fragment,i),Q(B.$$.fragment,i),Q(V.$$.fragment,i),Q(n.$$.fragment,i),Q(K.$$.fragment,i),T=!0)},o:function(i){X(p.$$.fragment,i),X(B.$$.fragment,i),X(V.$$.fragment,i),X(n.$$.fragment,i),X(K.$$.fragment,i),T=!1},d:function(i){i&&m(e),se(p),se(B),se(V),se(n),se(K)}};return ie("SvelteRegisterBlock",{block:he,id:be.name,type:"each",source:"(67:8) {#each $highscores.data.slice(18) as player, index}",ctx:c}),he}function ye(c){let e,a,f,s,u,h,p,g,w,H,Y,j,F,J,W,O,C,U,B,k,P,b,v;a=new Te({props:{label:"Back To Game",href:`${Pe}/`,$$slots:{default:[De]},$$scope:{ctx:c}},$$inline:!0});const V=[je,Ae,Re,Ge],z=[];function d(r,n){return r[0].error?0:r[0].step==="IDLE"?1:r[0].step==="LOADING"?2:3}P=d(c),b=z[P]=V[P](c);const t={c:function(){e=I("div"),ne(a.$$.fragment),f=S(),s=I("div"),u=I("h1"),h=I("span"),p=$("Highscores"),g=S(),w=I("p"),H=$("(Note: ties are not resolved here)"),Y=S(),j=I("p"),F=$("score = 10000 + 10000 * (((token in control) - (token given)) / (token given))"),J=S(),W=I("p"),O=$("The Score shown is the final score, based on block 21538868 (last block for April 8th 10PM UTC)"),C=S(),U=I("p"),B=$("Congrats to all players!"),k=S(),b.c(),this.h()},l:function(n){e=L(n,"DIV",{class:!0});var E=q(e);le(a.$$.fragment,E),f=N(E),s=L(E,"DIV",{class:!0});var y=q(s);u=L(y,"H1",{class:!0});var A=q(u);h=L(A,"SPAN",{class:!0});var ae=q(h);p=_(ae,"Highscores"),ae.forEach(m),A.forEach(m),g=N(y),w=L(y,"P",{class:!0});var K=q(w);H=_(K,"(Note: ties are not resolved here)"),K.forEach(m),Y=N(y),j=L(y,"P",{class:!0});var re=q(j);F=_(re,"score = 10000 + 10000 * (((token in control) - (token given)) / (token given))"),re.forEach(m),J=N(y),W=L(y,"P",{class:!0});var te=q(W);O=_(te,"The Score shown is the final score, based on block 21538868 (last block for April 8th 10PM UTC)"),te.forEach(m),C=N(y),U=L(y,"P",{class:!0});var T=q(U);B=_(T,"Congrats to all players!"),T.forEach(m),k=N(y),b.l(y),y.forEach(m),E.forEach(m),this.h()},h:function(){D(h,"class","font-black"),G(h,R,17,30,672),D(u,"class","text-cyan-400"),G(u,R,17,4,646),D(w,"class","text-gray-400 text-xs"),G(w,R,18,4,724),D(j,"class","text-gray-400"),G(j,R,19,4,800),D(W,"class","text-yellow-400"),G(W,R,20,4,912),D(U,"class","text-yellow-400"),G(U,R,23,4,1055),D(s,"class","markdown text-white p-3"),G(s,R,16,2,604),D(e,"class","w-full h-full bg-black text-white"),G(e,R,14,0,477)},m:function(n,E){M(n,e,E),oe(a,e,null),o(e,f),o(e,s),o(s,u),o(u,h),o(h,p),o(s,g),o(s,w),o(w,H),o(s,Y),o(s,j),o(j,F),o(s,J),o(s,W),o(W,O),o(s,C),o(s,U),o(U,B),o(s,k),z[P].m(s,null),v=!0},p:function(n,[E]){const y={};E&64&&(y.$$scope={dirty:E,ctx:n}),a.$set(y);let A=P;P=d(n),P===A?z[P].p(n,E):(ve(),X(z[A],1,1,()=>{z[A]=null}),_e(),b=z[P],b?b.p(n,E):(b=z[P]=V[P](n),b.c()),Q(b,1),b.m(s,null))},i:function(n){v||(Q(a.$$.fragment,n),Q(b),v=!0)},o:function(n){X(a.$$.fragment,n),X(b),v=!1},d:function(n){n&&m(e),se(a),z[P].d()}};return ie("SvelteRegisterBlock",{block:t,id:ye.name,type:"component",source:"",ctx:c}),t}function Fe(c,e,a){let f,s;Be($e,"highscores"),Ee(c,$e,g=>a(0,f=g)),Be(ke,"wallet"),Ee(c,ke,g=>a(1,s=g));let{$$slots:u={},$$scope:h}=e;Me("Highscores",u,[]),Se(()=>{$e.start()});const p=[];return Object.keys(e).forEach(g=>{!~p.indexOf(g)&&g.slice(0,2)!=="$$"&&g!=="slot"&&console.warn(`<Highscores> was created with unknown prop '${g}'`)}),c.$capture_state=()=>({base:Pe,wallet:ke,Blockie:ge,NavButton:Te,PlayCoin:ce,highscores:$e,onMount:Se,$highscores:f,$wallet:s}),[f,s]}class lt extends He{constructor(e){super(e);We(this,e,Fe,ye,Ce,{}),ie("SvelteRegisterComponent",{component:this,tagName:"Highscores",options:e,id:ye.name})}}export{lt as default};
//# sourceMappingURL=highscores.svelte-415f2e11.js.map
